{"version":3,"file":"static/js/async/docs_zh_tutorials_examples_csr-auth_mdx.67accf59.js","sources":["./docs/zh/tutorials/examples/csr-auth.mdx"],"sourcesContent":["globalThis.__RSPRESS_PAGE_META ||= {};\nglobalThis.__RSPRESS_PAGE_META[\"zh%2Ftutorials%2Fexamples%2Fcsr-auth.mdx\"] = {\"toc\":[],\"title\":\"路由鉴权\",\"frontmatter\":{\"title\":\"路由鉴权\"}};\nimport { useMDXComponents as _provideComponents } from \"@mdx-js/react\";\nimport Sandpack from '@site/src/components/Sandpack';\nfunction _createMdxContent(props) {\n    const _components = Object.assign({\n        h1: \"h1\",\n        a: \"a\",\n        p: \"p\",\n        ul: \"ul\",\n        li: \"li\",\n        code: \"code\",\n        pre: \"pre\"\n    }, _provideComponents(), props.components);\n    return <><_components.h1 id=\"路由鉴权\">{\"路由鉴权\"}<_components.a className=\"header-anchor\" aria-hidden=\"true\" href=\"#路由鉴权\">{\"#\"}</_components.a></_components.h1>{\"\\n\"}<_components.p>{\"Modern.js 默认提供的路由方式是基于 React Router 6 的约定式路由，具体可查看\"}<_components.a href=\"/guides/basic-features/routes#%E8%B7%AF%E7%94%B1%E6%96%B9%E6%A1%88\">{\"路由方案\"}</_components.a>{\"。\"}</_components.p>{\"\\n\"}<_components.p>{\"在一个 Web 应用中如果存在多个路由，我们可能需要对部分路由进行鉴权后才能访问。例如下面这个案例：\"}</_components.p>{\"\\n\"}<_components.ul>{\"\\n\"}<_components.li>{\"访问 \"}<_components.code>{\"/\"}</_components.code>{\" 路由，无需鉴权，可直接访问。\"}</_components.li>{\"\\n\"}<_components.li>{\"访问 \"}<_components.code>{\"/protected\"}</_components.code>{\" 路由，需要鉴权，如果无，自动跳转到 \"}<_components.code>{\"/login\"}</_components.code>{\" 路由，登录成功后返回 \"}<_components.code>{\"/protected\"}</_components.code>{\"。\"}</_components.li>{\"\\n\"}</_components.ul>{\"\\n\"}{\"\\n\"}<Sandpack template=\"web-app\"><_components.pre><_components.code className=\"language-tsx\" meta='title=\"src/routes/page.tsx\"'>{'import { Helmet } from \\'@modern-js/runtime/head\\';\\nimport \\'./index.css\\';\\n\\nconst PublicPage = (): JSX.Element => (\\n  <div className=\"container-box\">\\n    <Helmet>\\n      <link\\n        rel=\"icon\"\\n        type=\"image/x-icon\"\\n        href=\"https://lf3-static.bytednsdoc.com/obj/eden-cn/uhbfnupenuhf/favicon.ico\"\\n      />\\n    </Helmet>\\n    <h3>Public</h3>\\n  </div>\\n);\\n\\nexport default PublicPage;\\n\\n'}</_components.code></_components.pre><_components.pre><_components.code className=\"language-tsx\" meta='title=\"src/routes/layout.tsx\"'>{\"import { Link, Outlet } from '@modern-js/runtime/router';\\nimport { AuthProvider, AuthStatus } from './Auth';\\n\\nexport default function Layout() {\\n  return (\\n    <AuthProvider>\\n      <AuthStatus />\\n\\n      <ul>\\n        <li>\\n          <Link to=\\\"/\\\">Public Page</Link>\\n        </li>\\n        <li>\\n          <Link to=\\\"/protected\\\">Protected Page</Link>\\n        </li>\\n      </ul>\\n\\n      <Outlet />\\n    </AuthProvider>\\n  );\\n}\\n\\n\"}</_components.code></_components.pre><_components.pre><_components.code className=\"language-ts\" meta='title=\"src/routes/fakeAuth.ts\"'>{\"/**\\n * This represents some generic auth provider API, like Firebase.\\n */\\nconst fakeAuthProvider = {\\n  isAuthenticated: false,\\n  signin(callback: VoidFunction) {\\n    fakeAuthProvider.isAuthenticated = true;\\n    setTimeout(callback, 100); // fake async\\n  },\\n  signout(callback: VoidFunction) {\\n    fakeAuthProvider.isAuthenticated = false;\\n    setTimeout(callback, 100);\\n  },\\n};\\n\\nexport { fakeAuthProvider };\\n\\n\"}</_components.code></_components.pre><_components.pre><_components.code className=\"language-ts\" meta='title=\"src/routes/Auth.tsx\"'>{\"import React from 'react';\\nimport { useNavigate, Navigate, useLocation } from '@modern-js/runtime/router';\\nimport { fakeAuthProvider } from './fakeAuth';\\n\\ninterface AuthContextType {\\n  user: any;\\n  signin: (user: string, callback: VoidFunction) => void;\\n  signout: (callback: VoidFunction) => void;\\n}\\n\\nconst AuthContext = React.createContext<AuthContextType>(null!);\\n\\nexport function AuthProvider({ children }: { children: React.ReactNode }) {\\n  const [user, setUser] = React.useState<any>(null);\\n\\n  const signin = (newUser: string, callback: VoidFunction) =>\\n    fakeAuthProvider.signin(() => {\\n      setUser(newUser);\\n      callback();\\n    });\\n\\n  const signout = (callback: VoidFunction) =>\\n    fakeAuthProvider.signout(() => {\\n      setUser(null);\\n      callback();\\n    });\\n\\n  const value = { user, signin, signout };\\n\\n  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;\\n}\\n\\nexport function useAuth() {\\n  return React.useContext(AuthContext);\\n}\\n\\nexport function AuthStatus() {\\n  const auth = useAuth();\\n  console.log('auth', auth);\\n  const navigate = useNavigate();\\n\\n  if (!auth.user) {\\n    return <p>You are not logged in.</p>;\\n  }\\n\\n  return (\\n    <p>\\n      Welcome {auth.user}!{' '}\\n      <button\\n        type=\\\"button\\\"\\n        onClick={() => {\\n          auth.signout(() => navigate('/'));\\n        }}\\n      >\\n        Sign out\\n      </button>\\n    </p>\\n  );\\n}\\n\\nexport function RequireAuth({ children }: { children: JSX.Element }) {\\n  const auth = useAuth();\\n  const location = useLocation();\\n\\n  if (!auth.user) {\\n    // Redirect them to the /login page, but save the current location they were\\n    // trying to go to when they were redirected. This allows us to send them\\n    // along to that page after they login, which is a nicer user experience\\n    // than dropping them off on the home page.\\n    return <Navigate to=\\\"/login\\\" state={{ from: location }} replace />;\\n  }\\n\\n  return children;\\n}\\n\\n\"}</_components.code></_components.pre><_components.pre><_components.code className=\"language-ts\" meta='title=\"src/routes/protected/page.tsx\"'>{\"import { RequireAuth } from '../Auth';\\n\\nexport default function ProtectedPage() {\\n  return (\\n    <div className=\\\"container-box\\\">\\n      <RequireAuth>\\n        <h3>Protected</h3>\\n      </RequireAuth>\\n    </div>\\n  );\\n}\\n\\n\"}</_components.code></_components.pre><_components.pre><_components.code className=\"language-ts\" meta='title=\"src/routes/login/page.tsx\"'>{\"import { useLocation, useNavigate } from '@modern-js/runtime/router';\\nimport { useAuth } from '../Auth';\\n\\nexport default function Login() {\\n  const navigate = useNavigate();\\n  const location = useLocation();\\n  const auth = useAuth();\\n\\n  const from = location.state?.from?.pathname || '/';\\n\\n  function handleSubmit(event: React.FormEvent<HTMLFormElement>) {\\n    event.preventDefault();\\n\\n    const formData = new FormData(event.currentTarget);\\n    const username = formData.get('username') as string;\\n\\n    auth.signin(username, () => {\\n      // Send them back to the page they tried to visit when they were\\n      // redirected to the login page. Use { replace: true } so we don't create\\n      // another entry in the history stack for the login page.  This means that\\n      // when they get to the protected page and click the back button, they\\n      // won't end up back on the login page, which is also really nice for the\\n      // user experience.\\n      navigate(from, { replace: true });\\n    });\\n  }\\n\\n  return (\\n    <div>\\n      <p>You must log in to view the page at {from}</p>\\n\\n      <form onSubmit={handleSubmit}>\\n        <label>\\n          Username: <input name=\\\"username\\\" type=\\\"text\\\" />\\n        </label>{' '}\\n        <button type=\\\"submit\\\">Login</button>\\n      </form>\\n    </div>\\n  );\\n}\\n\\n\"}</_components.code></_components.pre></Sandpack></>;\n}\nfunction MDXContent(props = {}) {\n    const { wrapper: MDXLayout } = Object.assign({}, _provideComponents(), props.components);\n    return MDXLayout ? <MDXLayout {...props}><_createMdxContent {...props}/></MDXLayout> : _createMdxContent(props);\n}\nexport default MDXContent;\n"],"names":["_createMdxContent","props","_components","Object","assign","h1","a","p","ul","li","code","pre","components","id","className","href","template","meta","globalThis","__RSPRESS_PAGE_META","MDXLayout","wrapper","_"],"mappings":"sNAAA,E,gEAIA,SAASA,EAAkBC,CAAK,EAC5B,IAAMC,EAAcC,OAAOC,MAAM,CAAC,CAC9BC,GAAI,KACJC,EAAG,IACHC,EAAG,IACHC,GAAI,KACJC,GAAI,KACJC,KAAM,OACNC,IAAK,KACT,EAAG,yBAAsBV,EAAMW,UAAU,EACzC,MAAO,uB,UAAE,WAACV,EAAYG,EAAE,EAACQ,GAAG,O,UAAQ,OAAO,UAACX,EAAYI,CAAC,EAACQ,UAAU,gBAAgB,cAAY,OAAOC,KAAK,Q,SAAS,G,MAAsC,KAAK,WAACb,EAAYK,CAAC,E,UAAE,qDAAqD,UAACL,EAAYI,CAAC,EAACS,KAAK,qE,SAAsE,M,GAAwB,I,GAAqB,KAAK,UAACb,EAAYK,CAAC,E,SAAE,oD,GAAsE,KAAK,WAACL,EAAYM,EAAE,E,UAAE,KAAK,WAACN,EAAYO,EAAE,E,UAAE,MAAM,UAACP,EAAYQ,IAAI,E,SAAE,G,GAAwB,kB,GAAoC,KAAK,WAACR,EAAYO,EAAE,E,UAAE,MAAM,UAACP,EAAYQ,IAAI,E,SAAE,Y,GAAiC,sBAAsB,UAACR,EAAYQ,IAAI,E,SAAE,Q,GAA6B,eAAe,UAACR,EAAYQ,IAAI,E,SAAE,Y,GAAiC,I,GAAsB,K,GAAuB,KAAM,KAAK,WAAC,SAAQ,EAACM,SAAS,U,UAAU,UAACd,EAAYS,GAAG,E,SAAC,UAACT,EAAYQ,IAAI,EAACI,UAAU,eAAeG,KAAK,8B,SAA+B,6Z,KAAmc,UAACf,EAAYS,GAAG,E,SAAC,UAACT,EAAYQ,IAAI,EAACI,UAAU,eAAeG,KAAK,gC,SAAiC,4b,KAAke,UAACf,EAAYS,GAAG,E,SAAC,UAACT,EAAYQ,IAAI,EAACI,UAAU,cAAcG,KAAK,iC,SAAkC,4a,KAAkd,UAACf,EAAYS,GAAG,E,SAAC,UAACT,EAAYQ,IAAI,EAACI,UAAU,cAAcG,KAAK,8B,SAA+B,s9D,KAA4/D,UAACf,EAAYS,GAAG,E,SAAC,UAACT,EAAYQ,IAAI,EAACI,UAAU,cAAcG,KAAK,wC,SAAyC,wO,KAA8Q,UAACf,EAAYS,GAAG,E,SAAC,UAACT,EAAYQ,IAAI,EAACI,UAAU,cAAcG,KAAK,oC,SAAqC,6zC,UAC5kK,CAfA,GAAAC,UAAA,EAAWC,mBAAmB,EAA9B,GAAWA,mBAAmB,CAAK,CAAC,GACpCD,WAAWC,mBAAmB,CAAC,2CAA2C,CAAG,CAAC,IAAM,EAAE,CAAC,MAAQ,OAAO,YAAc,CAAC,MAAQ,MAAM,CAAC,EAmBpI,MAJA,W,IAAoBlB,EAAQ,UAAR,6CAAQ,CAAC,EACRmB,EAAc,AAAAjB,OAAOC,MAAM,CAAC,CAAC,EAAG,yBAAsBH,EAAMW,UAAU,EAA/ES,OAAO,CACf,OAAOD,EAAY,UAACA,EAAA,mBAAcnB,GAAA,C,SAAO,UAACD,EAAA,KAAAsB,CAAA,AAAAA,EAAA,GAAsBrB,G,IAAuBD,EAAkBC,EAC7G,C"}