(self.webpackChunk_modern_js_main_doc=self.webpackChunk_modern_js_main_doc||[]).push([["docs_zh_configure_app_server_ssr_mdx"],{8559:function(e,n,r){"use strict";r.r(n),r.d(n,{default:function(){return h}});var s,d=r("15169"),c=r("43932"),l=r("9880"),i=r("23169");function o(e){var n=Object.assign({h1:"h1",a:"a",ul:"ul",li:"li",strong:"strong",code:"code",p:"p",h3:"h3",pre:"pre",ol:"ol"},(0,i.useMDXComponents)(),e.components);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(n.h1,{id:"serverssr",children:["server.ssr",(0,l.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#serverssr",children:"#"})]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"类型："})," ",(0,l.jsx)(n.code,{children:"boolean"})," | ",(0,l.jsx)(n.code,{children:"Object"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"默认值："})," ",(0,l.jsx)(n.code,{children:"false"})]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"SSR 开关以及相关设置。"}),"\n",(0,l.jsxs)(n.h3,{id:"boolean-类型",children:["Boolean 类型",(0,l.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#boolean-类型",children:"#"})]}),"\n",(0,l.jsxs)(n.p,{children:["当值类型为 ",(0,l.jsx)(n.code,{children:"boolean"})," 时，表示是否开启 SSR 部署模式，默认 ",(0,l.jsx)(n.code,{children:"false"})," 不开启。"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-ts",meta:'title="modern.config.ts"',children:"export default defineConfig({\n  server: {\n    ssr: true,\n  },\n});\n"})}),"\n",(0,l.jsxs)(n.h3,{id:"object-类型",children:["Object 类型",(0,l.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#object-类型",children:"#"})]}),"\n",(0,l.jsxs)(n.p,{children:["当值类型为 ",(0,l.jsx)(n.code,{children:"Object"})," 时，可以配置如下属性："]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"mode"}),"：",(0,l.jsx)(n.code,{children:"string = 'string'"}),"，默认为使用 ",(0,l.jsx)(n.code,{children:"renderToString"})," 渲染。配置为 ",(0,l.jsx)(n.code,{children:"stream"})," 开启流式渲染。"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"forceCSR"}),"：",(0,l.jsx)(n.code,{children:"boolean = false"}),"，默认关闭强制 CSR 渲染。配置为 ",(0,l.jsx)(n.code,{children:"true"})," 后，在页面访问时添加 ",(0,l.jsx)(n.code,{children:"?csr=true"})," 或添加请求头 ",(0,l.jsx)(n.code,{children:"x-modern-ssr-fallback"})," 即可强制 CSR。"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"inlineScript"}),"：",(0,l.jsx)(n.code,{children:"boolean = true"}),"，默认情况下，SSR 的数据会以内联脚本的方式注入到 HTML 中，并且直接赋值给全局变量。配置为 ",(0,l.jsx)(n.code,{children:"false"})," 后，会下发 JSON，而不是赋值给全局变量。"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"disablePrerender"}),": ",(0,l.jsx)(n.code,{children:"boolean = fasle"}),", 为了兼容旧数据请求方式 - ",(0,l.jsx)(n.code,{children:"useLoader"}),", 默认情况下 Modern.js 会对组件进行一次预渲染即有两次渲染。\n开发者在保证项目中没有使用 useLoader Api 情况下, 可通过配置 ",(0,l.jsx)(n.code,{children:"disablePrerender=true"}),"来减少一次渲染。"]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-ts",meta:'title="modern.config.ts"',children:"export default defineConfig({\n  server: {\n    ssr: {\n      forceCSR: true,\n      mode: 'stream',\n      inlineScript: false,\n      disablePrerender: true,\n    },\n  },\n});\n"})}),"\n",(0,l.jsxs)(n.h3,{id:"主动降级",children:["主动降级",(0,l.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#主动降级",children:"#"})]}),"\n",(0,l.jsx)(n.p,{children:"在生产环境，有时需要将 SSR 项目主动降级到 CSR，例如："}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"SSR 出现故障，需要降级到 CSR，保证产品可用性。"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"SSR 正常数据获取时页面渲染正常，但出错降级后渲染失败，需要进行调试。"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"SSR 服务压力过大，需要部分流量直接降级为 CSR，避免服务宕机。"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:["在项目中配置 ",(0,l.jsx)(n.code,{children:"server.ssr.forceCSR"})," 为 ",(0,l.jsx)(n.code,{children:"true"})," 后，我们可以通过请求的查询字符串，或是请求头来控制这一行为。"]}),"\n",(0,l.jsx)(n.p,{children:"例如在自定义 Web Server 的中间件中，检测到流量大于某一阈值时，主动降级："}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-ts",meta:'title="server/index.ts"',children:"export const middleware = (ctx, next) => {\n  const { req, res } = ctx;\n  if (condition) {\n    req.headers['x-modern-ssr-fallback'] = '1';\n  }\n\n  next();\n};\n"})})]})}(s=globalThis).__RSPRESS_PAGE_META||(s.__RSPRESS_PAGE_META={}),globalThis.__RSPRESS_PAGE_META["zh%2Fconfigure%2Fapp%2Fserver%2Fssr.mdx"]={toc:[{text:"Boolean 类型",id:"boolean-类型",depth:3},{text:"Object 类型",id:"object-类型",depth:3},{text:"主动降级",id:"主动降级",depth:3}],title:"server.ssr",frontmatter:{sidebar_label:"ssr"}};var h=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=Object.assign({},(0,i.useMDXComponents)(),e.components).wrapper;return n?(0,l.jsx)(n,(0,c._)((0,d._)({},e),{children:(0,l.jsx)(o,(0,d._)({},e))})):o(e)}}}]);