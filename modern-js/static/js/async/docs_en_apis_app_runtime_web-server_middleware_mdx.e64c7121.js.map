{"version":3,"file":"static/js/async/docs_en_apis_app_runtime_web-server_middleware_mdx.e64c7121.js","sources":["./docs/en/apis/app/runtime/web-server/middleware.mdx"],"sourcesContent":["globalThis.__RSPRESS_PAGE_META ||= {};\nglobalThis.__RSPRESS_PAGE_META[\"en%2Fapis%2Fapp%2Fruntime%2Fweb-server%2Fmiddleware.mdx\"] = {\"toc\":[{\"text\":\"Usage\",\"id\":\"usage\",\"depth\":2},{\"text\":\"Function Signature\",\"id\":\"function-signature\",\"depth\":2},{\"text\":\"Input\",\"id\":\"input\",\"depth\":3},{\"text\":\"Example\",\"id\":\"example\",\"depth\":2},{\"text\":\"Tracking\",\"id\":\"tracking\",\"depth\":3},{\"text\":\"Inject Tools & Data\",\"id\":\"inject-tools--data\",\"depth\":3},{\"text\":\"Framework Extension\",\"id\":\"framework-extension\",\"depth\":3}],\"title\":\"Middleware\",\"frontmatter\":{\"title\":\"Middleware\"}};\nimport { useMDXComponents as _provideComponents } from \"@mdx-js/react\";\nfunction _createMdxContent(props) {\n    const _components = Object.assign({\n        h1: \"h1\",\n        a: \"a\",\n        p: \"p\",\n        div: \"div\",\n        h2: \"h2\",\n        pre: \"pre\",\n        code: \"code\",\n        h3: \"h3\",\n        ul: \"ul\",\n        li: \"li\"\n    }, _provideComponents(), props.components);\n    return <><_components.h1 id=\"middleware\">{\"Middleware\"}<_components.a className=\"header-anchor\" aria-hidden=\"true\" href=\"#middleware\">{\"#\"}</_components.a></_components.h1>{\"\\n\"}<_components.p>{\"Used to extend the built-in Web Server of Modern.js, unlike \"}<_components.a href=\"/apis/app/runtime/web-server/hook\">{\"Hook\"}</_components.a>{\", Middleware can directly operate Node's origin request and response, and can be extended using the framework plugin.\"}</_components.p>{\"\\n\"}<_components.div className=\"modern-directive note\"><_components.div className=\"modern-directive-title\">{\"NOTE\"}</_components.div><_components.div className=\"modern-directive-content\"><_components.p>{\"For more detail, see \"}<_components.a href=\"/guides/advanced-features/web-server\">{\"Extend Web Server\"}</_components.a>{\".\"}</_components.p>{\"\\n\"}</_components.div></_components.div>{\"\\n\"}<_components.h2 id=\"usage\">{\"Usage\"}<_components.a className=\"header-anchor\" aria-hidden=\"true\" href=\"#usage\">{\"#\"}</_components.a></_components.h2>{\"\\n\"}<_components.pre><_components.code className=\"language-ts\">{\"import { Middleware } from '@modern-js/runtime/server';\\n\\nexport const middleware: Middleware = async (context, next) => {};\\nexport const middleware: Middleware[] = [\\n  async (context, next) => {},\\n  async (context, next) => {},\\n];\\n\"}</_components.code></_components.pre>{\"\\n\"}<_components.div className=\"modern-directive info\"><_components.div className=\"modern-directive-title\">{\"INFO\"}</_components.div><_components.div className=\"modern-directive-content\"><_components.p>{\"Before using this API, please execute \"}<_components.code>{\"pnpm run new\"}</_components.code>{' to create a new \"Custom Web Server\" source code directory.'}</_components.p>{\"\\n\"}<_components.pre><_components.code className=\"language-bash\">{'pnpm run new\\n? Please select the operation you want: Create Element\\n? Please select the type of element to create: New \"Custom Web Server\" source code directory\\n'}</_components.code></_components.pre>{\"\\n\"}</_components.div></_components.div>{\"\\n\"}<_components.h2 id=\"function-signature\">{\"Function Signature\"}<_components.a className=\"header-anchor\" aria-hidden=\"true\" href=\"#function-signature\">{\"#\"}</_components.a></_components.h2>{\"\\n\"}<_components.pre><_components.code className=\"language-ts\">{\"type Middleware = (\\n  context: MiddlewareContext,\\n  next: NextFunction,\\n) => Promise<void> | void;\\n\\ntype MiddlewareContext = {\\n  response: {\\n    set: (key: string, value: string) => void;\\n    status: (code: number) => void;\\n    cookies: {\\n      set: (key: string, value: string, options?: any) => void;\\n      clear: () => void;\\n    };\\n    raw: (\\n      body: string,\\n      { status, headers }: { status: number; headers: Record<string, any> },\\n    ) => void;\\n    locals: Record<string, any>;\\n  };\\n  request: {\\n    host: string;\\n    pathname: string;\\n    query: Record<string, any>;\\n    cookie: string;\\n    cookies: {\\n      get: (key: string) => string;\\n    };\\n    headers: IncomingHttpHeaders;\\n  };\\n  source: {\\n    req: IncomingMessage;\\n    res: ServerResponse;\\n  };\\n};\\n\"}</_components.code></_components.pre>{\"\\n\"}<_components.h3 id=\"input\">{\"Input\"}<_components.a className=\"header-anchor\" aria-hidden=\"true\" href=\"#input\">{\"#\"}</_components.a></_components.h3>{\"\\n\"}<_components.ul>{\"\\n\"}<_components.li><_components.code>{\"context\"}</_components.code>{\": Middleware context.\"}{\"\\n\"}<_components.ul>{\"\\n\"}<_components.li><_components.code>{\"response\"}</_components.code>{\": provides a series of methods to process the response.\"}</_components.li>{\"\\n\"}<_components.li><_components.code>{\"request\"}</_components.code>{\": provides a series of methods to get request info.\"}</_components.li>{\"\\n\"}<_components.li><_components.code>{\"source\"}</_components.code>{\": provides Node.js native \"}<_components.code>{\"req\"}</_components.code>{\" and \"}<_components.code>{\"res\"}</_components.code>{\" object.\"}</_components.li>{\"\\n\"}</_components.ul>{\"\\n\"}</_components.li>{\"\\n\"}<_components.li><_components.code>{\"next\"}</_components.code>{\": call next listener (not affect the server process, only current hook).\"}</_components.li>{\"\\n\"}</_components.ul>{\"\\n\"}<_components.div className=\"modern-directive warning\"><_components.div className=\"modern-directive-title\">{\"WARNING\"}</_components.div><_components.div className=\"modern-directive-content\"><_components.p>{\"The execution of the \"}<_components.code>{\"next\"}</_components.code>{\" function does not affect built-in processes, only controls whether the next middleware executes. Rendering processes are interrupted only when the response is written.\\n\"}</_components.p></_components.div></_components.div>{\"\\n\"}<_components.h2 id=\"example\">{\"Example\"}<_components.a className=\"header-anchor\" aria-hidden=\"true\" href=\"#example\">{\"#\"}</_components.a></_components.h2>{\"\\n\"}<_components.h3 id=\"tracking\">{\"Tracking\"}<_components.a className=\"header-anchor\" aria-hidden=\"true\" href=\"#tracking\">{\"#\"}</_components.a></_components.h3>{\"\\n\"}<_components.pre><_components.code className=\"language-ts\">{\"export const Middleware = () => async (ctx, next) => {\\n  const start = Date.now();\\n  ctx.res.once('finish', () => {\\n    console.log(Date.now() - start);\\n  });\\n};\\n\"}</_components.code></_components.pre>{\"\\n\"}<_components.h3 id=\"inject-tools--data\">{\"Inject Tools & Data\"}<_components.a className=\"header-anchor\" aria-hidden=\"true\" href=\"#inject-tools--data\">{\"#\"}</_components.a></_components.h3>{\"\\n\"}<_components.p>{\"Modern.js provides \"}<_components.code>{\"res.locals\"}</_components.code>{\" to store local variables for the current request.\"}</_components.p>{\"\\n\"}<_components.pre><_components.code className=\"language-ts\">{\"export const Middleware = () => async (ctx, next) => {\\n  ctx.res.locals.id = 'Modern.js';\\n  ctx.res.locals.rpc = createRpcInstance();\\n};\\n\"}</_components.code></_components.pre>{\"\\n\"}<_components.h3 id=\"framework-extension\">{\"Framework Extension\"}<_components.a className=\"header-anchor\" aria-hidden=\"true\" href=\"#framework-extension\">{\"#\"}</_components.a></_components.h3>{\"\\n\"}<_components.p>{\"Middleware can also use runtime framework extensions like BFF.\"}</_components.p>{\"\\n\"}<_components.p>{\"When using framework runtime extensions, type information is exported from \"}<_components.code>{\"@modern-js/runtime/{namespace}\"}</_components.code>{\". Middleware can use framework syntax, such as framework middleware writing, the following is pseudo-code:\"}</_components.p>{\"\\n\"}<_components.pre><_components.code className=\"language-ts\">{\"import { SomeType } from '@modern-js/runtime/{namespace}';\\n\\nexport const middleware: SomeType = (ctx, next) => {\\n  console.log(ctx.url);\\n  next();\\n};\\n\"}</_components.code></_components.pre>{\"\\n\"}<_components.p>{\"By default, the framework extension capability of Web Server is turned off after installing the framework extension plugin. If you want to use the framework extension, you can turn it on through \"}<_components.a href=\"/configure/app/server/enable-framework-ext\">{\"'server.enableFrameworkExt'\"}</_components.a>{\".\"}</_components.p>{\"\\n\"}<_components.div className=\"modern-directive info\"><_components.div className=\"modern-directive-title\">{\"INFO\"}</_components.div><_components.div className=\"modern-directive-content\"><_components.p>{\"The type name exported by the framework extension may not 'Middleware', but is named by the framework extension plugin.\"}</_components.p></_components.div></_components.div></>;\n}\nfunction MDXContent(props = {}) {\n    const { wrapper: MDXLayout } = Object.assign({}, _provideComponents(), props.components);\n    return MDXLayout ? <MDXLayout {...props}><_createMdxContent {...props}/></MDXLayout> : _createMdxContent(props);\n}\nexport default MDXContent;\n"],"names":["_createMdxContent","props","_components","Object","assign","h1","a","p","div","h2","pre","code","h3","ul","li","components","id","className","href","globalThis","__RSPRESS_PAGE_META","MDXLayout","wrapper","_"],"mappings":"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"}