/*! For license information please see 17527.6cb78a81.js.LICENSE.txt */
(self.webpackChunk_modern_js_main_doc=self.webpackChunk_modern_js_main_doc||[]).push([["17527"],{58359:function(e,r,n){"use strict";n.r(r),n.d(r,{default:function(){return l}});var s=n("9880"),d=n("23169");function i(e){let r=Object.assign({h1:"h1",a:"a",p:"p",strong:"strong",div:"div",h2:"h2",code:"code",pre:"pre",h3:"h3",ol:"ol",li:"li"},(0,d.useMDXComponents)(),e.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(r.h1,{id:"\u81EA\u5B9A\u4E49-web-server",children:["\u81EA\u5B9A\u4E49 Web Server",(0,s.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#\u81EA\u5B9A\u4E49-web-server",children:"#"})]}),"\n",(0,s.jsx)(r.p,{children:"Modern.js \u4F5C\u4E3A\u4EE5\u5BA2\u6237\u7AEF\u4E3A\u4E2D\u5FC3\u7684\u5F00\u53D1\u6846\u67B6\uFF0C\u5BF9\u670D\u52A1\u7AEF\u7684\u5B9A\u5236\u80FD\u529B\u8F83\u5F31\u3002\u800C\u5728\u6709\u4E9B\u5F00\u53D1\u573A\u666F\u4E0B\uFF0C\u9700\u8981\u5B9A\u5236\u7279\u6B8A\u7684\u670D\u52A1\u7AEF\u903B\u8F91\uFF0C\u4F8B\u5982\u7528\u6237\u9274\u6743\u3001\u8BF7\u6C42\u9884\u5904\u7406\u3001\u6DFB\u52A0\u9875\u9762\u6E32\u67D3\u9AA8\u67B6\u7B49\u3002"}),"\n",(0,s.jsxs)(r.p,{children:["\u4E00\u4E9B\u5F00\u53D1\u8005\u53EF\u80FD\u4F1A\u6709\u7591\u60D1\uFF0CModern.js \u5DF2\u7ECF\u63D0\u4F9B\u4E86 ",(0,s.jsx)(r.a,{href:"/guides/advanced-features/bff/function",children:"BFF \u80FD\u529B"}),"\uFF0C\u4E3A\u4EC0\u4E48\u8FD8\u9700\u8981",(0,s.jsx)(r.strong,{children:"\u81EA\u5B9A\u4E49 Web Server"}),"\u3002"]}),"\n",(0,s.jsx)(r.p,{children:"\u56E0\u4E3A\u5728\u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0C\u9875\u9762\u8DEF\u7531\u5E76\u4E0D\u4F1A\u7ECF\u8FC7 BFF\uFF0C\u5B83\u6CA1\u6709\u529E\u6CD5\u4E3A\u9875\u9762\u8BBF\u95EE\u63D0\u4F9B\u670D\u52A1\u7AEF\u7684\u5B9A\u5236\u903B\u8F91\u3002\u4E4B\u6240\u4EE5\u8FD9\u6837\u8BBE\u8BA1\uFF0C\u662F\u56E0\u4E3A\u6211\u4EEC\u4E0D\u5E0C\u671B\u63A7\u5236\u9875\u9762\u7684\u670D\u52A1\u4E0E BFF \u670D\u52A1\u7ED1\u5B9A\u5728\u4E00\u8D77\uFF0C\u907F\u514D BFF \u7684\u6846\u67B6\u9650\u5236\u9875\u9762\u7684\u90E8\u7F72\u65B9\u5F0F\u3002\u4F8B\u5982\u5C06\u9875\u9762\u4E0E BFF \u5206\u5F00\u6258\u7BA1\u3001\u5C06\u9875\u9762\u670D\u52A1\u90E8\u7F72\u5230\u975E Node \u7684\u73AF\u5883\u4E0A\uFF0C\u6216\u662F\u9488\u5BF9\u90E8\u7F72\u5E73\u53F0\u505A\u5B9A\u5236\u7B49\u3002"}),"\n",(0,s.jsx)(r.p,{children:"\u51FA\u4E8E\u4E0A\u8FF0\u539F\u56E0\uFF0CModern.js \u63D0\u4F9B\u4E86\u4E09\u79CD\u65B9\u5F0F\uFF0C\u8BA9\u9879\u76EE\u53EF\u4EE5\u5728\u6839\u636E\u9700\u6C42\uFF0C\u6E10\u8FDB\u5F0F\u7684\u5B9A\u5236\u670D\u52A1\u7AEF\u80FD\u529B\u3002"}),"\n",(0,s.jsxs)(r.div,{className:"rspress-directive warning",children:[(0,s.jsx)(r.div,{className:"rspress-directive-title",children:"WARNING"}),(0,s.jsx)(r.div,{className:"rspress-directive-content",children:(0,s.jsx)(r.p,{children:"\u4E09\u79CD\u6269\u5C55\u65B9\u5F0F\u65E0\u6CD5\u540C\u65F6\u5DE5\u4F5C\uFF0C\u5F00\u53D1\u8005\u9700\u8981\u6839\u636E\u573A\u666F\u9009\u62E9\u5408\u9002\u7684\u65B9\u5F0F\u3002"})})]}),"\n",(0,s.jsxs)(r.h2,{id:"\u4F7F\u7528-api-\u6269\u5C55-web-server",children:["\u4F7F\u7528 API \u6269\u5C55 Web Server",(0,s.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#\u4F7F\u7528-api-\u6269\u5C55-web-server",children:"#"})]}),"\n",(0,s.jsx)(r.p,{children:"\u7B2C\u4E00\u79CD\u65B9\u5F0F\u662F\u901A\u8FC7 Modern.js \u63D0\u4F9B\u7684\u670D\u52A1\u7AEF\u8FD0\u884C\u65F6 API\uFF0C\u5728\u7279\u5B9A\u7684\u751F\u547D\u5468\u671F\u5BF9\u670D\u52A1\u7AEF\u8FDB\u884C\u5B9A\u5236\u3002\u63D0\u4F9B\u8FD9\u79CD\u65B9\u5F0F\u7684\u76EE\u7684\u662F\u5728\u90E8\u5206\u60C5\u51B5\u4E0B\uFF0C\u5F00\u53D1\u8005\u5E76\u4E0D\u9700\u8981\u63A7\u5236\u5B8C\u6574\u7684 Web Server\uFF0C\u53EA\u9700\u8981\u6DFB\u52A0\u670D\u52A1\u7AEF\u903B\u8F91\u5373\u53EF\u3002"}),"\n",(0,s.jsxs)(r.p,{children:["\u8FD9\u79CD\u65B9\u5F0F\u65E0\u6CD5\u63A7\u5236\u5B8C\u6574\u7684 Web Server\uFF0C\u5E76\u4E14\u6269\u5C55\u903B\u8F91",(0,s.jsx)(r.strong,{children:"\u53EA\u5728\u8BF7\u6C42\u9875\u9762\u65F6\u751F\u6548"}),"\u3002\u56E0\u6B64\uFF0C\u5B83\u9002\u7528\u4E8E\u670D\u52A1\u7AEF\u903B\u8F91\u76F8\u5BF9\u7B80\u5355\uFF0C\u4E0D\u5E0C\u671B\u989D\u5916\u521B\u5EFA BFF \u6216\u8005 BFF \u548C\u9875\u9762\u65E0\u9700\u516C\u7528\u670D\u52A1\u7AEF\u903B\u8F91\u573A\u666F\u3002"]}),"\n",(0,s.jsxs)(r.p,{children:["\u53EF\u4EE5\u5728\u9879\u76EE\u6839\u76EE\u5F55\u6267\u884C ",(0,s.jsx)(r.code,{children:"pnpm run new"})," \u547D\u4EE4\uFF0C\u5F00\u542F\u300C\u81EA\u5B9A\u4E49 Web Serve\u300D\u529F\u80FD\uFF1A"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",children:"? \u8BF7\u9009\u62E9\u4F60\u60F3\u8981\u7684\u64CD\u4F5C \u521B\u5EFA\u5DE5\u7A0B\u5143\u7D20\n? \u8BF7\u9009\u62E9\u521B\u5EFA\u5143\u7D20\u7C7B\u578B \u65B0\u5EFA\u300C\u81EA\u5B9A\u4E49 Web Server\u300D\u6E90\u7801\u76EE\u5F55\n"})}),"\n",(0,s.jsxs)(r.p,{children:["\u6267\u884C\u547D\u4EE4\u540E\uFF0C\u5728 ",(0,s.jsx)(r.code,{children:"modern.config.ts"})," \u4E2D\u6CE8\u518C ",(0,s.jsx)(r.code,{children:"@modern-js/plugin-server"})," \u63D2\u4EF6:"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ts",meta:'title="modern.config.ts"',children:"import { serverPlugin } from '@modern-js/plugin-server';\n\nexport default defineConfig({\n  plugins: [..., serverPlugin()],\n});\n"})}),"\n",(0,s.jsxs)(r.p,{children:["\u5F00\u542F\u529F\u80FD\u540E\uFF0C\u9879\u76EE\u76EE\u5F55\u4E0B\u4F1A\u81EA\u52A8\u521B\u5EFA ",(0,s.jsx)(r.code,{children:"server/index.ts"})," \u6587\u4EF6\uFF0C\u53EF\u4EE5\u5728\u8FD9\u4E2A\u6587\u4EF6\u4E2D\u7F16\u5199\u81EA\u5B9A\u4E49\u903B\u8F91\u3002Modern.js \u63D0\u4F9B\u4E86 ",(0,s.jsx)(r.strong,{children:"Hook"})," \u4E0E ",(0,s.jsx)(r.strong,{children:"Middleware"})," \u4E24\u7C7B API \u6765\u6269\u5C55 Web Server\u3002"]}),"\n",(0,s.jsxs)(r.h3,{id:"hook",children:["Hook",(0,s.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#hook",children:"#"})]}),"\n",(0,s.jsx)(r.p,{children:"Modern.js \u63D0\u4F9B\u7684 Hook \u7528\u4E8E\u63A7\u5236 Web Server \u4E2D\u7684\u5185\u7F6E\u903B\u8F91\uFF0C\u6240\u6709\u7684\u9875\u9762\u8BF7\u6C42\u90FD\u4F1A\u7ECF\u8FC7 Hook\u3002"}),"\n",(0,s.jsxs)(r.p,{children:["\u76EE\u524D\u63D0\u4F9B\u4E86\u4E24\u79CD Hook\uFF0C\u5206\u522B\u662F ",(0,s.jsx)(r.code,{children:"AfterMatch"})," \u548C ",(0,s.jsx)(r.code,{children:"AfterRender"}),"\uFF0C\u53EF\u4EE5\u7528\u4E8E\u4FEE\u6539\u6E32\u67D3\u7ED3\u679C\u3002\u53EF\u4EE5\u5728 ",(0,s.jsx)(r.code,{children:"server/index.ts"})," \u4E2D\u8FD9\u6837\u5199\uFF1A"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ts",children:"import type {\n  AfterMatchHook,\n  AfterRenderHook,\n} from '@modern-js/runtime/server';\n\nexport const afterMatch: AfterMatchHook = (ctx, next) => {\n  next();\n};\n\nexport const afterRender: AfterRenderHook = (ctx, next) => {\n  next();\n};\n"})}),"\n",(0,s.jsx)(r.p,{children:"\u9879\u76EE\u5728\u4F7F\u7528 Hook \u65F6\uFF0C\u5E94\u8BE5\u6709\u4EE5\u4E0B\u6700\u4F73\u5B9E\u8DF5\uFF1A"}),"\n",(0,s.jsxs)(r.ol,{children:["\n",(0,s.jsx)(r.li,{children:"\u5728 afterMatch \u4E2D\u505A\u6743\u9650\u6821\u9A8C\u3002"}),"\n",(0,s.jsx)(r.li,{children:"\u5728 afterMatch \u505A Rewrite \u548C Redirect\u3002"}),"\n",(0,s.jsx)(r.li,{children:"\u5728 afterRender \u4E2D\u505A HTML \u5185\u5BB9\u6CE8\u5165\u3002"}),"\n"]}),"\n",(0,s.jsxs)(r.div,{className:"rspress-directive note",children:[(0,s.jsx)(r.div,{className:"rspress-directive-title",children:"NOTE"}),(0,s.jsx)(r.div,{className:"rspress-directive-content",children:(0,s.jsxs)(r.p,{children:["\u8BE6\u7EC6 API \u548C\u66F4\u591A\u7528\u6CD5\u53EF\u4EE5\u67E5\u770B ",(0,s.jsx)(r.a,{href:"/apis/app/runtime/web-server/hook",children:"Hook"}),"\u3002\n"]})})]}),"\n",(0,s.jsxs)(r.h3,{id:"middleware",children:["Middleware",(0,s.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#middleware",children:"#"})]}),"\n",(0,s.jsx)(r.p,{children:"\u5BF9\u4E8E\u67D0\u4E9B\u9879\u76EE\uFF0C\u53EF\u80FD\u5728\u670D\u52A1\u7AEF\u6709\u66F4\u591A\u7684\u9700\u6C42\uFF0CModern.js \u63D0\u4F9B\u4E86 Middleware \u4E3A Web Server \u6DFB\u52A0\u524D\u7F6E\u4E2D\u95F4\u4EF6\u3002\u5B83\u53EA\u80FD\u8FD0\u884C\u5728 Node \u73AF\u5883\u4E0B\uFF0C\u56E0\u6B64\u5982\u679C\u9879\u76EE\u88AB\u90E8\u7F72\u5230\u5176\u4ED6\u73AF\u5883\u4E2D\uFF0C\u5982 Worker \u73AF\u5883\uFF0C\u5219\u4E0D\u53EF\u4EE5\u4F7F\u7528 Middleware\u3002"}),"\n",(0,s.jsx)(r.p,{children:"Modern.js \u9ED8\u8BA4\u63D0\u4F9B\u4E86\u4E00\u5957 API \u4F9B\u9879\u76EE\u4F7F\u7528\uFF1A"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ts",children:"import { Middlewre } from '@modern-js/runtime/server';\n\nexport const middleware: Middlewre = (context, next) => {\n  const {\n    source: { req, res },\n  } = context;\n  console.log(req.url);\n  next();\n};\n"})}),"\n",(0,s.jsxs)(r.div,{className:"rspress-directive note",children:[(0,s.jsx)(r.div,{className:"rspress-directive-title",children:"NOTE"}),(0,s.jsx)(r.div,{className:"rspress-directive-content",children:(0,s.jsxs)(r.p,{children:["\u8BE6\u7EC6 API \u548C\u66F4\u591A\u7528\u6CD5\u53EF\u4EE5\u67E5\u770B ",(0,s.jsx)(r.a,{href:"/apis/app/runtime/web-server/middleware",children:"Middleware"}),"\u3002\n"]})})]}),"\n",(0,s.jsx)(r.p,{children:"\u9879\u76EE\u5728\u4F7F\u7528 Middleware \u65F6\uFF0C\u5E94\u8BE5\u6709\u4EE5\u4E0B\u6700\u4F73\u5B9E\u8DF5\uFF1A"}),"\n",(0,s.jsxs)(r.ol,{children:["\n",(0,s.jsx)(r.li,{children:"\u5728 Middleware \u4E2D\u53EF\u4EE5\u76F4\u63A5\u64CD\u4F5C\u539F\u751F\u7684\u8BF7\u6C42\u3001\u54CD\u5E94\u5BF9\u8C61\uFF0C\u505A\u6570\u636E\u6253\u70B9\u3001\u6CE8\u5165 SSR \u6E32\u67D3\u53EF\u80FD\u7528\u5230\u7684 Node \u670D\u52A1\uFF08\u6570\u636E\u5E93\u3001Redis \u7B49\uFF09\u3002"}),"\n",(0,s.jsx)(r.li,{children:"\u5728 Middleware \u91CC\u53EF\u4EE5\u505A\u7C7B\u4F3C\u529F\u80FD\u6253\u6807\u3001\u722C\u866B\u4F18\u5316\u7B49\u529F\u80FD\u3002"}),"\n",(0,s.jsx)(r.li,{children:"\u5728 Middleware \u91CC\u53EF\u4EE5\u65E0\u89C6\u540E\u7EED\u9ED8\u8BA4\u6E32\u67D3\uFF0C\u81EA\u5B9A\u4E49\u6E32\u67D3\u6D41\u7A0B\u3002"}),"\n"]}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"\u603B\u7684\u6765\u8BF4\uFF0CCSR \u9879\u76EE\u4E2D\uFF0C\u4F7F\u7528 Hook \u57FA\u672C\u80FD\u6EE1\u8DB3\u7B80\u5355\u573A\u666F\u7684\u6240\u6709\u9700\u6C42\u3002SSR \u9879\u76EE\u4E2D\uFF0C\u53EF\u4EE5\u4F7F\u7528 Middleware \u505A\u66F4\u590D\u6742\u7684 Node \u6269\u5C55\u3002"})}),"\n",(0,s.jsxs)(r.h2,{id:"\u901A\u8FC7-bff-\u6258\u7BA1\u9875\u9762\u8BF7\u6C42",children:["\u901A\u8FC7 BFF \u6258\u7BA1\u9875\u9762\u8BF7\u6C42",(0,s.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#\u901A\u8FC7-bff-\u6258\u7BA1\u9875\u9762\u8BF7\u6C42",children:"#"})]}),"\n",(0,s.jsx)(r.p,{children:"\u7B2C\u4E8C\u79CD\u65B9\u5F0F\uFF0C\u662F\u5229\u7528 BFF \u6765\u6258\u7BA1\u9875\u9762\u6E32\u67D3\uFF0C\u8FD9\u79CD\u65B9\u5F0F\u4E0B\uFF0C\u6240\u6709\u7684\u8BF7\u6C42\u90FD\u4F1A\u5148\u6253\u5230 BFF \u7684\u670D\u52A1\u3002"}),"\n",(0,s.jsx)(r.p,{children:"\u56E0\u4E3A\u8FD9\u79CD\u65B9\u5F0F\u53EF\u4EE5\u901A\u8FC7 BFF \u7EDF\u4E00\u63A7\u5236\u6240\u6709\u8BF7\u6C42\u7684\u670D\u52A1\u7AEF\u903B\u8F91\u3002\u56E0\u6B64\uFF0C\u5B83\u9002\u7528\u4E8E\u670D\u52A1\u7AEF\u903B\u8F91\u590D\u6742\uFF0CBFF \u548C\u9875\u9762\u9700\u8981\u516C\u7528\u670D\u52A1\u7AEF\u903B\u8F91\u7684\u573A\u666F\u3002\u4F46\u5B83\u6574\u4F53\u8FD8\u662F\u4F9D\u6258\u4E8E Modern.js \u7684 Web Server \u8FD0\u884C\uFF0C\u65E0\u6CD5\u5C06\u903B\u8F91\u8FD0\u884C\u5728\u5DF2\u6709\u7684\u670D\u52A1\u4E0A\u3002"}),"\n",(0,s.jsxs)(r.p,{children:["\u4F7F\u7528\u8FD9\u79CD\u65B9\u5F0F\uFF0C\u6211\u4EEC\u9700\u8981\u5148\u901A\u8FC7 ",(0,s.jsx)(r.code,{children:"pnpm new"})," \u5F00\u542F\u300CBFF\u300D\u529F\u80FD\u3002\u7136\u540E\u5728\u914D\u7F6E\u6587\u4EF6\u4E2D\u6DFB\u52A0 ",(0,s.jsx)(r.a,{href:"/configure/app/bff/enable-handle-web",children:(0,s.jsx)(r.code,{children:"bff.enableHandleWeb"})})," \u914D\u7F6E\uFF1A"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ts",children:"export default defineConfig({\n  bff: {\n    enableHandleWeb: true,\n  },\n});\n"})}),"\n",(0,s.jsxs)(r.p,{children:["\u5F53\u8BE5\u503C\u8BBE\u7F6E\u4E3A ",(0,s.jsx)(r.code,{children:"true"})," \u65F6\uFF0C\u9875\u9762\u8BF7\u6C42\u6D41\u91CF\u4E5F\u4F1A\u7ECF\u8FC7 BFF\uFF0C\u5E76\u4E14 Modern.js \u5185\u7F6E\u7684\u9875\u9762\u6E32\u67D3\u7684\u903B\u8F91\u9ED8\u8BA4\u4F1A\u4F5C\u4E3A BFF \u670D\u52A1\u7684\u6700\u540E\u4E00\u4E2A\u4E2D\u95F4\u4EF6\u8FD0\u884C\u3002"]}),"\n",(0,s.jsxs)(r.h2,{id:"\u5B8C\u5168\u81EA\u5B9A\u4E49\u7684-web-server",children:["\u5B8C\u5168\u81EA\u5B9A\u4E49\u7684 Web Server",(0,s.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#\u5B8C\u5168\u81EA\u5B9A\u4E49\u7684-web-server",children:"#"})]}),"\n",(0,s.jsxs)(r.div,{className:"rspress-directive note",children:[(0,s.jsx)(r.div,{className:"rspress-directive-title",children:"NOTE"}),(0,s.jsx)(r.div,{className:"rspress-directive-content",children:(0,s.jsx)(r.p,{children:"\u656C\u8BF7\u671F\u5F85"})})]})]})}function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:r}=Object.assign({},(0,d.useMDXComponents)(),e.components);return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(i,{...e})}):i(e)}var l=c;c.__RSPRESS_PAGE_META={},c.__RSPRESS_PAGE_META["zh%2Fguides%2Fadvanced-features%2Fweb-server.mdx"]={toc:[{text:"\u4F7F\u7528 API \u6269\u5C55 Web Server",id:"\u4F7F\u7528-api-\u6269\u5C55-web-server",depth:2},{text:"Hook",id:"hook",depth:3},{text:"Middleware",id:"middleware",depth:3},{text:"\u901A\u8FC7 BFF \u6258\u7BA1\u9875\u9762\u8BF7\u6C42",id:"\u901A\u8FC7-bff-\u6258\u7BA1\u9875\u9762\u8BF7\u6C42",depth:2},{text:"\u5B8C\u5168\u81EA\u5B9A\u4E49\u7684 Web Server",id:"\u5B8C\u5168\u81EA\u5B9A\u4E49\u7684-web-server",depth:2}],title:"\u81EA\u5B9A\u4E49 Web Server",frontmatter:{sidebar_position:16}}}}]);