(self.webpackChunk_modern_js_builder_doc=self.webpackChunk_modern_js_builder_doc||[]).push([["docs_zh_api_config-source_mdx"],{55207:function(e,n,r){"use strict";r.r(n),r.d(n,{default:function(){return N}});var s,c=r("15169"),i=r("43932"),d=r("9880"),l=r("23169"),o=r("88509"),a=r("47567"),t=r("1439"),h=r("47833"),x=r("61835"),j=r("47747"),p=r("11839"),u=r("29113"),m=r("53035"),g=r("96281"),f=r("61635"),b=r("28202");function _(e){var n=Object.assign({h1:"h1",a:"a",p:"p",h2:"h2"},(0,l.useMDXComponents)(),e.components);return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(n.h1,{id:"source-config",children:["Source Config",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#source-config",children:"#"})]}),"\n",(0,d.jsx)(n.p,{children:"本章节描述了 Builder 中与源代码解析、编译方式相关的配置。"}),"\n",(0,d.jsxs)(n.h2,{id:"sourcealias",children:["source.alias",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#sourcealias",children:"#"})]}),"\n","\n",(0,d.jsx)(o.default,{}),"\n",(0,d.jsxs)(n.h2,{id:"sourcealiasstrategy",children:["source.aliasStrategy",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#sourcealiasstrategy",children:"#"})]}),"\n","\n",(0,d.jsx)(a.default,{}),"\n",(0,d.jsxs)(n.h2,{id:"sourceinclude",children:["source.include",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#sourceinclude",children:"#"})]}),"\n","\n",(0,d.jsx)(t.default,{}),"\n",(0,d.jsxs)(n.h2,{id:"sourceexclude",children:["source.exclude",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#sourceexclude",children:"#"})]}),"\n","\n",(0,d.jsx)(h.default,{}),"\n",(0,d.jsxs)(n.h2,{id:"sourcecompilejsdatauri",children:["source.compileJsDataURI",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#sourcecompilejsdatauri",children:"#"})]}),"\n","\n",(0,d.jsx)(x.default,{}),"\n",(0,d.jsxs)(n.h2,{id:"sourcedefine",children:["source.define",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#sourcedefine",children:"#"})]}),"\n","\n",(0,d.jsx)(j.default,{}),"\n",(0,d.jsxs)(n.h2,{id:"sourceglobalvars",children:["source.globalVars",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#sourceglobalvars",children:"#"})]}),"\n","\n",(0,d.jsx)(p.default,{}),"\n",(0,d.jsxs)(n.h2,{id:"sourcemodulescopes",children:["source.moduleScopes",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#sourcemodulescopes",children:"#"})]}),"\n","\n",(0,d.jsx)(u.default,{}),"\n",(0,d.jsxs)(n.h2,{id:"sourcetransformimport",children:["source.transformImport",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#sourcetransformimport",children:"#"})]}),"\n","\n",(0,d.jsx)(m.default,{}),"\n",(0,d.jsxs)(n.h2,{id:"sourcepreentry",children:["source.preEntry",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#sourcepreentry",children:"#"})]}),"\n","\n",(0,d.jsx)(g.default,{}),"\n",(0,d.jsxs)(n.h2,{id:"sourceresolveextensionprefix",children:["source.resolveExtensionPrefix",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#sourceresolveextensionprefix",children:"#"})]}),"\n","\n",(0,d.jsx)(f.default,{}),"\n",(0,d.jsxs)(n.h2,{id:"sourceresolvemainfields",children:["source.resolveMainFields",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#sourceresolvemainfields",children:"#"})]}),"\n","\n",(0,d.jsx)(b.default,{})]})}(s=globalThis).__RSPRESS_PAGE_META||(s.__RSPRESS_PAGE_META={}),globalThis.__RSPRESS_PAGE_META["zh%2Fapi%2Fconfig-source.mdx"]={toc:[{text:"source.alias",id:"sourcealias",depth:2},{text:"source.aliasStrategy",id:"sourcealiasstrategy",depth:2},{text:"source.include",id:"sourceinclude",depth:2},{text:"source.exclude",id:"sourceexclude",depth:2},{text:"source.compileJsDataURI",id:"sourcecompilejsdatauri",depth:2},{text:"source.define",id:"sourcedefine",depth:2},{text:"source.globalVars",id:"sourceglobalvars",depth:2},{text:"source.moduleScopes",id:"sourcemodulescopes",depth:2},{text:"source.transformImport",id:"sourcetransformimport",depth:2},{text:"source.preEntry",id:"sourcepreentry",depth:2},{text:"source.resolveExtensionPrefix",id:"sourceresolveextensionprefix",depth:2},{text:"source.resolveMainFields",id:"sourceresolvemainfields",depth:2}],title:"Source Config",frontmatter:{extractApiHeaders:[2]}};var N=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=Object.assign({},(0,l.useMDXComponents)(),e.components).wrapper;return n?(0,d.jsx)(n,(0,i._)((0,c._)({},e),{children:(0,d.jsx)(_,(0,c._)({},e))})):_(e)}},88509:function(e,n,r){"use strict";r.r(n),r.d(n,{default:function(){return a}});var s,c=r("15169"),i=r("43932"),d=r("9880"),l=r("23169");function o(e){var n=Object.assign({ul:"ul",li:"li",strong:"strong",code:"code",p:"p",a:"a",div:"div",h3:"h3",pre:"pre"},(0,l.useMDXComponents)(),e.components);return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"类型："})," ",(0,d.jsx)(n.code,{children:"Record<string, string | string[]> | Function"})]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"默认值："})," ",(0,d.jsx)(n.code,{children:"undefined"})]}),"\n"]}),"\n",(0,d.jsxs)(n.p,{children:["设置文件引用的别名，对应 webpack 和 Rspack 的 ",(0,d.jsx)(n.a,{href:"https://webpack.js.org/configuration/resolve/#resolvealias",target:"_blank",rel:"noopener noreferrer",children:"resolve.alias"})," 配置。"]}),"\n",(0,d.jsxs)(n.div,{className:"modern-directive tip",children:[(0,d.jsx)(n.div,{className:"modern-directive-title",children:"TIP"}),(0,d.jsx)(n.div,{className:"modern-directive-content",children:(0,d.jsxs)(n.p,{children:["对于 TypeScript 项目，你只需要在 ",(0,d.jsx)(n.code,{children:"tsconfig.json"})," 中配置 ",(0,d.jsx)(n.a,{href:"https://www.typescriptlang.org/tsconfig#paths",target:"_blank",rel:"noopener noreferrer",children:"compilerOptions.paths"})," 即可，Builder 会自动识别它，不需要额外配置 ",(0,d.jsx)(n.code,{children:"source.alias"})," 字段，详见 ",(0,d.jsx)(n.a,{href:"https://modernjs.dev/builder/guide/advanced/alias.html",target:"_blank",rel:"noopener noreferrer",children:"「路径别名」"}),"。\n"]})})]}),"\n",(0,d.jsxs)(n.h3,{id:"object-类型",children:["Object 类型",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#object-类型",children:"#"})]}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"alias"})," 的值可以定义为 Object 类型，其中的相对路径会自动被 Builder 转换为绝对路径。"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:"export default {\n  source: {\n    alias: {\n      '@common': './src/common',\n    },\n  },\n};\n"})}),"\n",(0,d.jsxs)(n.p,{children:["以上配置完成后，如果你在代码中引用 ",(0,d.jsx)(n.code,{children:"@common/Foo.tsx"}),", 则会映射到 ",(0,d.jsx)(n.code,{children:"<project>/src/common/Foo.tsx"})," 路径上。"]}),"\n",(0,d.jsxs)(n.h3,{id:"function-类型",children:["Function 类型",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#function-类型",children:"#"})]}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"alias"})," 的值定义为函数时，可以接受预设的 alias 对象，并对其进行修改。"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:"export default {\n  source: {\n    alias: alias => {\n      alias['@common'] = './src/common';\n    },\n  },\n};\n"})}),"\n",(0,d.jsx)(n.p,{children:"也可以在函数中返回一个新对象作为最终结果，新对象会覆盖预设的 alias 对象。"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:"export default {\n  source: {\n    alias: alias => {\n      return {\n        '@common': './src/common',\n      };\n    },\n  },\n};\n"})}),"\n",(0,d.jsxs)(n.h3,{id:"精确匹配",children:["精确匹配",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#精确匹配",children:"#"})]}),"\n",(0,d.jsxs)(n.p,{children:["默认情况，",(0,d.jsx)(n.code,{children:"source.alias"})," 会自动匹配子路径，比如以下配置："]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:"import path from 'path';\n\nexport default {\n  source: {\n    alias: {\n      '@common': './src/common',\n    },\n  },\n};\n"})}),"\n",(0,d.jsx)(n.p,{children:"它的匹配结果如下："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:"import a from '@common'; // 解析为 `./src/common`\nimport b from '@common/util'; // 解析为 `./src/common/util`\n"})}),"\n",(0,d.jsxs)(n.p,{children:["你可以添加 ",(0,d.jsx)(n.code,{children:"$"})," 符号来开启精确匹配，开启后将不会自动匹配子路径。"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:"import path from 'path';\n\nexport default {\n  source: {\n    alias: {\n      '@common$': './src/common',\n    },\n  },\n};\n"})}),"\n",(0,d.jsx)(n.p,{children:"它的匹配结果如下："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:"import a from '@common'; // 解析为 `./src/common`\nimport b from '@common/util'; // 保持 `@common/util` 不变\n"})}),"\n",(0,d.jsxs)(n.h3,{id:"处理-npm-包",children:["处理 npm 包",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#处理-npm-包",children:"#"})]}),"\n",(0,d.jsxs)(n.p,{children:["你可以使用 ",(0,d.jsx)(n.code,{children:"alias"})," 将某个 npm 包指向统一的目录。"]}),"\n",(0,d.jsxs)(n.p,{children:["比如项目中安装了多份 ",(0,d.jsx)(n.code,{children:"react"}),"，你可以将 ",(0,d.jsx)(n.code,{children:"react"})," 统一指向根目录的 ",(0,d.jsx)(n.code,{children:"node_modules"})," 中安装的版本，避免出现打包多份 React 代码的问题。"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:"import path from 'path';\n\nexport default {\n  source: {\n    alias: {\n      react: path.resolve(__dirname, './node_modules/react'),\n    },\n  },\n};\n"})}),"\n",(0,d.jsx)(n.p,{children:"当你在使用 alias 处理 npm 包时，请留意项目中是否使用了这个包不同的 major 版本。"}),"\n",(0,d.jsx)(n.p,{children:"比如你的项目中某个模块或 npm 依赖使用了 React 18 的 API，如果你将 React alias 到 17 版本，就会导致该模块无法引用到 React 18 的 API，导致代码异常。"})]})}(s=globalThis).__RSPRESS_PAGE_META||(s.__RSPRESS_PAGE_META={}),globalThis.__RSPRESS_PAGE_META["zh%2Fconfig%2Fsource%2Falias.md"]={toc:[{text:"Object 类型",id:"object-类型",depth:3},{text:"Function 类型",id:"function-类型",depth:3},{text:"精确匹配",id:"精确匹配",depth:3},{text:"处理 npm 包",id:"处理-npm-包",depth:3}],title:"",frontmatter:{}};var a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=Object.assign({},(0,l.useMDXComponents)(),e.components).wrapper;return n?(0,d.jsx)(n,(0,i._)((0,c._)({},e),{children:(0,d.jsx)(o,(0,c._)({},e))})):o(e)}},47567:function(e,n,r){"use strict";r.r(n),r.d(n,{default:function(){return a}});var s,c=r("15169"),i=r("43932"),d=r("9880"),l=r("23169");function o(e){var n=Object.assign({ul:"ul",li:"li",strong:"strong",code:"code",p:"p",h3:"h3",a:"a",pre:"pre"},(0,l.useMDXComponents)(),e.components);return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"类型："})," ",(0,d.jsx)(n.code,{children:"'prefer-tsconfig' | 'prefer-alias'"})]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"默认值："})," ",(0,d.jsx)(n.code,{children:"'prefer-tsconfig'"})]}),"\n"]}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"source.aliasStrategy"})," 用于控制 ",(0,d.jsx)(n.code,{children:"tsconfig.json"})," 中的 ",(0,d.jsx)(n.code,{children:"paths"})," 选项与打包工具的 ",(0,d.jsx)(n.code,{children:"alias"})," 选项的优先级。"]}),"\n",(0,d.jsxs)(n.h3,{id:"prefer-tsconfig",children:["prefer-tsconfig",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#prefer-tsconfig",children:"#"})]}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"source.aliasStrategy"})," 默认为 ",(0,d.jsx)(n.code,{children:"'prefer-tsconfig'"}),"，此时 ",(0,d.jsx)(n.code,{children:"tsconfig.json"})," 中的 ",(0,d.jsx)(n.code,{children:"paths"})," 选项和打包工具的 ",(0,d.jsx)(n.code,{children:"alias"})," 选项都会生效，但 tsconfig paths 选项的优先级更高。"]}),"\n",(0,d.jsx)(n.p,{children:"比如同时配置以下内容："}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"tsconfig paths:"}),"\n"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-json",meta:'title="tsconfig.json"',children:'{\n  "compilerOptions": {\n    "paths": {\n      "@common/*": ["./src/common-1/*"]\n    }\n  }\n}\n'})}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"source.alias"}),":"]}),"\n"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-ts",children:"export default {\n  source: {\n    alias: {\n      '@common': './src/common-2',\n      '@utils': './src/utils',\n    },\n  },\n};\n"})}),"\n",(0,d.jsx)(n.p,{children:"由于 tsconfig paths 的优先级更高，所以："}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"@common"})," 会使用 tsconfig paths 定义的值，指向 ",(0,d.jsx)(n.code,{children:"./src/common-1"})]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"@utils"})," 会使用 ",(0,d.jsx)(n.code,{children:"source.alias"})," 定义的值，指向 ",(0,d.jsx)(n.code,{children:"./src/utils"})]}),"\n"]}),"\n",(0,d.jsxs)(n.h3,{id:"prefer-alias",children:["prefer-alias",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#prefer-alias",children:"#"})]}),"\n",(0,d.jsxs)(n.p,{children:["当 ",(0,d.jsx)(n.code,{children:"source.aliasStrategy"})," 的值为 ",(0,d.jsx)(n.code,{children:"prefer-alias"})," 时，",(0,d.jsx)(n.code,{children:"tsconfig.json"})," 中的 ",(0,d.jsx)(n.code,{children:"paths"})," 选项只用于提供 TypeScript 类型定义，而不会对打包结果产生任何影响。此时，构建工具只会读取 ",(0,d.jsx)(n.code,{children:"alias"})," 选项作为路径别名。"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-ts",children:"export default {\n  source: {\n    aliasStrategy: 'prefer-alias',\n  },\n};\n"})}),"\n",(0,d.jsx)(n.p,{children:"比如同时配置以下内容："}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"tsconfig paths:"}),"\n"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-json",meta:'title="tsconfig.json"',children:'{\n  "compilerOptions": {\n    "paths": {\n      "@common/*": ["./src/common-1/*"],\n      "@utils/*": ["./src/utils/*"]\n    }\n  }\n}\n'})}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"source.alias"}),":"]}),"\n"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-ts",children:"export default {\n  source: {\n    alias: {\n      '@common': './src/common-2',\n    },\n  },\n};\n"})}),"\n",(0,d.jsxs)(n.p,{children:["由于 tsconfig paths 只用于提供类型，所以最终只有 ",(0,d.jsx)(n.code,{children:"@common"})," 别名生效，并指向 ",(0,d.jsx)(n.code,{children:"./src/common-2"})," 目录。"]}),"\n",(0,d.jsxs)(n.p,{children:["大部分情况下你不需要使用 ",(0,d.jsx)(n.code,{children:"prefer-alias"}),"，但当你需要动态生成一些别名配置时，可以考虑使用它。比如，基于环境变量来生成 ",(0,d.jsx)(n.code,{children:"alias"})," 选项："]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-ts",children:"export default {\n  source: {\n    alias: {\n      '@common':\n        process.env.NODE_ENV === 'production'\n          ? './src/common-prod'\n          : './src/common-dev',\n    },\n  },\n};\n"})})]})}(s=globalThis).__RSPRESS_PAGE_META||(s.__RSPRESS_PAGE_META={}),globalThis.__RSPRESS_PAGE_META["zh%2Fconfig%2Fsource%2FaliasStrategy.md"]={toc:[{text:"prefer-tsconfig",id:"prefer-tsconfig",depth:3},{text:"prefer-alias",id:"prefer-alias",depth:3}],title:"",frontmatter:{}};var a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=Object.assign({},(0,l.useMDXComponents)(),e.components).wrapper;return n?(0,d.jsx)(n,(0,i._)((0,c._)({},e),{children:(0,d.jsx)(o,(0,c._)({},e))})):o(e)}},61835:function(e,n,r){"use strict";r.r(n),r.d(n,{default:function(){return a}});var s,c=r("15169"),i=r("43932"),d=r("9880"),l=r("23169");function o(e){var n=Object.assign({ul:"ul",li:"li",strong:"strong",code:"code",p:"p",pre:"pre",h3:"h3",a:"a"},(0,l.useMDXComponents)(),e.components);return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"类型："})," ",(0,d.jsx)(n.code,{children:"boolean"})]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"默认值："})," ",(0,d.jsx)(n.code,{children:"true"})]}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:"该选项用于控制是否编译 data URI 中的 JavaScript 代码。"}),"\n",(0,d.jsx)(n.p,{children:"默认情况下，Builder 会使用 Babel 或 SWC 对 data URI 中的代码进行编译。比如以下代码："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:"import x from 'data:text/javascript,export default 1;';\n\nimport 'data:text/javascript;charset=utf-8;base64,Y29uc29sZS5sb2coJ2lubGluZSAxJyk7';\n"})}),"\n",(0,d.jsxs)(n.h3,{id:"示例",children:["示例",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#示例",children:"#"})]}),"\n",(0,d.jsx)(n.p,{children:"添加以下配置来关闭："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:"export default {\n  source: {\n    compileJsDataURI: false,\n  },\n};\n"})})]})}(s=globalThis).__RSPRESS_PAGE_META||(s.__RSPRESS_PAGE_META={}),globalThis.__RSPRESS_PAGE_META["zh%2Fconfig%2Fsource%2FcompileJsDataURI.md"]={toc:[{text:"示例",id:"示例",depth:3}],title:"",frontmatter:{}};var a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=Object.assign({},(0,l.useMDXComponents)(),e.components).wrapper;return n?(0,d.jsx)(n,(0,i._)((0,c._)({},e),{children:(0,d.jsx)(o,(0,c._)({},e))})):o(e)}},47747:function(e,n,r){"use strict";r.r(n),r.d(n,{default:function(){return a}});var s,c=r("15169"),i=r("43932"),d=r("9880"),l=r("23169");function o(e){var n=Object.assign({ul:"ul",li:"li",strong:"strong",code:"code",p:"p",a:"a",div:"div",h3:"h3",pre:"pre"},(0,l.useMDXComponents)(),e.components);return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"类型："})," ",(0,d.jsx)(n.code,{children:"Record<string, unknown>"})]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"默认值："})," ",(0,d.jsx)(n.code,{children:"{}"})]}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:"构建时将代码中的变量替换成其它值或者表达式，可以用于在代码逻辑中区分开发环境与生产环境等场景。"}),"\n",(0,d.jsxs)(n.p,{children:["传入的配置对象的键名是需要替换变量的名称，或者是用 ",(0,d.jsx)(n.code,{children:"."})," 连接的多个标识符，配置项的值则根据类型进行不同的处理："]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"字符串会被当作代码片段。"}),"\n",(0,d.jsx)(n.li,{children:"包括函数在内的其他类型会被转换成字符串。"}),"\n",(0,d.jsxs)(n.li,{children:["嵌套对象的父子键名之间会用 ",(0,d.jsx)(n.code,{children:"."})," 连接作为需要替换的变量名。"]}),"\n",(0,d.jsx)(n.li,{children:"以 typeof 开头的键名会用来替换 typeof 调用。"}),"\n"]}),"\n",(0,d.jsxs)(n.p,{children:["更多细节参考 ",(0,d.jsx)(n.a,{href:"https://webpack.js.org/plugins/define-plugin/",target:"_blank",rel:"noopener noreferrer",children:"webpack - DefinePlugin"}),"。"]}),"\n",(0,d.jsxs)(n.div,{className:"modern-directive tip",children:[(0,d.jsx)(n.div,{className:"modern-directive-title",children:"TIP"}),(0,d.jsx)(n.div,{className:"modern-directive-content",children:(0,d.jsxs)(n.p,{children:["在使用 Rspack 作为打包工具时，支持的类型可参考 ",(0,d.jsx)(n.a,{href:"https://www.rspack.dev/zh/config/builtins.html#builtinsdefine",target:"_blank",rel:"noopener noreferrer",children:"Rspack.builtins.define"}),"\n"]})})]}),"\n",(0,d.jsxs)(n.h3,{id:"示例",children:["示例",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#示例",children:"#"})]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:"export default {\n  source: {\n    define: {\n      PRODUCTION: JSON.stringify(true),\n      VERSION: JSON.stringify('5fa3b9'),\n      BROWSER_SUPPORTS_HTML5: true,\n      TWO: '1 + 1',\n      'typeof window': JSON.stringify('object'),\n      'process.env.NODE_ENV': JSON.stringify(process.env.NODE_ENV),\n      'import.meta': { test: undefined },\n    },\n  },\n};\n"})}),"\n",(0,d.jsx)(n.p,{children:"表达式会被替换为对应的代码段："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:"const foo = TWO;\n\n// ⬇️ Turn into being...\nconst foo = 1 + 1;\n"})})]})}(s=globalThis).__RSPRESS_PAGE_META||(s.__RSPRESS_PAGE_META={}),globalThis.__RSPRESS_PAGE_META["zh%2Fconfig%2Fsource%2Fdefine.md"]={toc:[{text:"示例",id:"示例",depth:3}],title:"",frontmatter:{}};var a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=Object.assign({},(0,l.useMDXComponents)(),e.components).wrapper;return n?(0,d.jsx)(n,(0,i._)((0,c._)({},e),{children:(0,d.jsx)(o,(0,c._)({},e))})):o(e)}},47833:function(e,n,r){"use strict";r.r(n),r.d(n,{default:function(){return a}});var s,c=r("15169"),i=r("43932"),d=r("9880"),l=r("23169");function o(e){var n=Object.assign({ul:"ul",li:"li",strong:"strong",code:"code",p:"p",a:"a",div:"div",pre:"pre"},(0,l.useMDXComponents)(),e.components);return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"类型："})," ",(0,d.jsx)(n.code,{children:"Array<string | RegExp>"})]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"默认值："})," ",(0,d.jsx)(n.code,{children:"[]"})]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"打包工具："})," ",(0,d.jsx)(n.code,{children:"仅支持 webpack"})]}),"\n"]}),"\n",(0,d.jsxs)(n.p,{children:["指定不需要编译的 JavaScript/TypeScript 文件。用法与 webpack 中的 ",(0,d.jsx)(n.a,{href:"https://webpack.js.org/configuration/module/#ruleexclude",target:"_blank",rel:"noopener noreferrer",children:"Rule.exclude"})," 一致，支持传入字符串或正则表达式来匹配模块的路径。"]}),"\n",(0,d.jsxs)(n.div,{className:"modern-directive tip",children:[(0,d.jsx)(n.div,{className:"modern-directive-title",children:"TIP"}),(0,d.jsx)(n.div,{className:"modern-directive-content",children:(0,d.jsxs)(n.p,{children:["在使用 Rspack 作为打包工具时，默认",(0,d.jsx)(n.strong,{children:"所有文件"}),"都会经过编译，同时，不支持通过 ",(0,d.jsx)(n.code,{children:"source.exclude"})," 排除。\n"]})})]}),"\n",(0,d.jsx)(n.p,{children:"比如:"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:"import path from 'path';\n\nexport default {\n  source: {\n    exclude: [path.resolve(__dirname, 'src/module-a'), /src\\/module-b/],\n  },\n};\n"})})]})}(s=globalThis).__RSPRESS_PAGE_META||(s.__RSPRESS_PAGE_META={}),globalThis.__RSPRESS_PAGE_META["zh%2Fconfig%2Fsource%2Fexclude.md"]={toc:[],title:"",frontmatter:{}};var a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=Object.assign({},(0,l.useMDXComponents)(),e.components).wrapper;return n?(0,d.jsx)(n,(0,i._)((0,c._)({},e),{children:(0,d.jsx)(o,(0,c._)({},e))})):o(e)}},11839:function(e,n,r){"use strict";r.r(n),r.d(n,{default:function(){return a}});var s,c=r("15169"),i=r("43932"),d=r("9880"),l=r("23169");function o(e){var n=Object.assign({ul:"ul",li:"li",strong:"strong",code:"code",pre:"pre",p:"p",h3:"h3",a:"a"},(0,l.useMDXComponents)(),e.components);return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"类型："})," ",(0,d.jsx)(n.code,{children:"Record<string, JSONValue> | Function"})]}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.strong,{children:"默认值："})}),"\n"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-ts",children:"// Builder 默认会添加环境变量 `process.env.NODE_ENV`，因此你不需要手动添加它。\nconst defaultGlobalVars = {\n  'process.env.NODE_ENV': process.env.NODE_ENV,\n};\n"})}),"\n",(0,d.jsxs)(n.p,{children:["用于在构建时将类似 ",(0,d.jsx)(n.code,{children:"process.env.FOO"})," 的全局变量表达式替换为指定的值，比如："]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:"console.log(process.env.NODE_ENV);\n\n// ⬇️ Turn into being...\nconsole.log('development');\n"})}),"\n",(0,d.jsxs)(n.h3,{id:"示例",children:["示例",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#示例",children:"#"})]}),"\n",(0,d.jsxs)(n.p,{children:["在下方示例中，会在代码中注入 ",(0,d.jsx)(n.code,{children:"ENABLE_VCONSOLE"})," 和 ",(0,d.jsx)(n.code,{children:"APP_CONTEXT"})," 两个环境变量："]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:"export default {\n  source: {\n    globalVars: {\n      ENABLE_VCONSOLE: true,\n      APP_CONTEXT: { answer: 42 },\n    },\n  },\n};\n"})}),"\n",(0,d.jsx)(n.p,{children:"你可以在代码中直接使用它们："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:"if (ENABLE_VCONSOLE) {\n  // do something\n}\n\nconsole.log(APP_CONTEXT);\n"})}),"\n",(0,d.jsxs)(n.h3,{id:"函数用法",children:["函数用法",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#函数用法",children:"#"})]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.strong,{children:"类型："})}),"\n"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-ts",children:"type GlobalVarsFn = (\n  obj: Record<string, JSONValue>,\n  utils: { env: NodeEnv; target: BuilderTarget },\n) => Record<string, JSONValue> | void;\n"})}),"\n",(0,d.jsxs)(n.p,{children:["你可以将 ",(0,d.jsx)(n.code,{children:"source.globalVars"})," 设置为一个函数，从而动态设置一些环境变量的值。"]}),"\n",(0,d.jsx)(n.p,{children:"比如，根据当前的构建产物类型进行动态设置："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:"export default {\n  source: {\n    globalVars(obj, { target }) {\n      obj['MY_TARGET'] = target === 'node' ? 'server' : 'client';\n    },\n  },\n};\n"})}),"\n",(0,d.jsxs)(n.h3,{id:"与-define-的区别",children:["与 define 的区别",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#与-define-的区别",children:"#"})]}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"source.globalVars"})," 是 ",(0,d.jsx)(n.code,{children:"source.define"})," 的一个语法糖，它们之间唯一的区别是，",(0,d.jsx)(n.code,{children:"source.globalVars"})," 会自动将传入的值进行 JSON 序列化处理，这使得设置全局变量的值更加方便。注意 ",(0,d.jsx)(n.code,{children:"globalVars"})," 的每个值都需要是可以被 JSON 序列化的值。"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:"export default {\n  source: {\n    globalVars: {\n      'process.env.BUILD_VERSION': '0.0.1',\n      'import.meta.foo': { bar: 42 },\n      'import.meta.baz': false,\n    },\n    define: {\n      'process.env.BUILD_VERSION': JSON.stringify('0.0.1'),\n      'import.meta': {\n        foo: JSON.stringify({ bar: 42 }),\n        baz: JSON.stringify(false),\n      },\n    },\n  },\n};\n"})}),"\n",(0,d.jsxs)(n.h3,{id:"注意事项",children:["注意事项",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#注意事项",children:"#"})]}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"source.globalVars"})," 是通过字符串替换的形式来注入环境变量的，因此它无法对「解构赋值」等动态写法生效。"]}),"\n",(0,d.jsxs)(n.p,{children:["在使用解构赋值时，Builder 将无法判断变量 ",(0,d.jsx)(n.code,{children:"NODE_ENV"})," 是否与要替换的表达式 ",(0,d.jsx)(n.code,{children:"process.env.NODE_ENV"})," 存在关联，因此以下使用方式是无效的："]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:"const { NODE_ENV } = process.env;\nconsole.log(NODE_ENV);\n// ❌ Won't get a string.\n"})})]})}(s=globalThis).__RSPRESS_PAGE_META||(s.__RSPRESS_PAGE_META={}),globalThis.__RSPRESS_PAGE_META["zh%2Fconfig%2Fsource%2FglobalVars.md"]={toc:[{text:"示例",id:"示例",depth:3},{text:"函数用法",id:"函数用法",depth:3},{text:"与 define 的区别",id:"与-define-的区别",depth:3},{text:"注意事项",id:"注意事项",depth:3}],title:"",frontmatter:{}};var a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=Object.assign({},(0,l.useMDXComponents)(),e.components).wrapper;return n?(0,d.jsx)(n,(0,i._)((0,c._)({},e),{children:(0,d.jsx)(o,(0,c._)({},e))})):o(e)}},1439:function(e,n,r){"use strict";r.r(n),r.d(n,{default:function(){return a}});var s,c=r("15169"),i=r("43932"),d=r("9880"),l=r("23169");function o(e){var n=Object.assign({ul:"ul",li:"li",strong:"strong",code:"code",p:"p",a:"a",pre:"pre",div:"div",h3:"h3"},(0,l.useMDXComponents)(),e.components);return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"类型："})," ",(0,d.jsx)(n.code,{children:"Array<string | RegExp>"})]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"默认值："})," ",(0,d.jsx)(n.code,{children:"[]"})]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"打包工具："})," ",(0,d.jsx)(n.code,{children:"仅支持 webpack"})]}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:"出于编译性能的考虑，默认情况下，Builder 不会编译 node_modules 下的 JavaScript/TypeScript 文件，也不会编译当前工程目录外部的 JavaScript/TypeScript 文件。"}),"\n",(0,d.jsxs)(n.p,{children:["通过 ",(0,d.jsx)(n.code,{children:"source.include"})," 配置项，可以指定需要 Builder 额外进行编译的目录或模块。",(0,d.jsx)(n.code,{children:"source.include"})," 的用法与 webpack 中的 ",(0,d.jsx)(n.a,{href:"https://webpack.js.org/configuration/module/#ruleinclude",target:"_blank",rel:"noopener noreferrer",children:"Rule.include"})," 一致，支持传入字符串或正则表达式来匹配模块的路径。"]}),"\n",(0,d.jsx)(n.p,{children:"比如:"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-ts",children:"import path from 'path';\n\nexport default {\n  source: {\n    include: [path.resolve(__dirname, '../other-dir')],\n  },\n};\n"})}),"\n",(0,d.jsxs)(n.div,{className:"modern-directive tip",children:[(0,d.jsx)(n.div,{className:"modern-directive-title",children:"TIP"}),(0,d.jsx)(n.div,{className:"modern-directive-content",children:(0,d.jsxs)(n.p,{children:["在使用 Rspack 作为打包工具时，默认",(0,d.jsx)(n.strong,{children:"所有文件"}),"都会经过编译，同时，不支持通过 ",(0,d.jsx)(n.code,{children:"source.exclude"})," 排除。\n"]})})]}),"\n",(0,d.jsxs)(n.h3,{id:"编译-npm-包",children:["编译 npm 包",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#编译-npm-包",children:"#"})]}),"\n",(0,d.jsx)(n.p,{children:"比较典型的使用场景是编译 node_modules 下的 npm 包，因为某些第三方依赖存在 ES6+ 的语法，这可能导致在低版本浏览器上无法运行，你可以通过该选项指定需要编译的依赖，从而解决此类问题。"}),"\n",(0,d.jsxs)(n.p,{children:["以 ",(0,d.jsx)(n.code,{children:"query-string"})," 为例，你可以做如下的配置："]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-ts",children:"import path from 'path';\n\nexport default {\n  source: {\n    include: [\n      // 方法一:\n      // 先通过 require.resolve 来获取模块的路径\n      // 再通过 path.dirname 来指向对应的目录\n      path.dirname(require.resolve('query-string')),\n      // 方法二:\n      // 通过正则表达式进行匹配\n      // 所有包含 `/node_modules/query-string/` 的路径都会被匹配到\n      /\\/node_modules\\/query-string\\//,\n    ],\n  },\n};\n"})}),"\n",(0,d.jsx)(n.p,{children:'上述两种方法分别通过 "路径前缀" 和 "正则表达式" 来匹配文件的绝对路径，值得留意的是，项目中所有被引用的模块都会经过匹配，因此你不能使用过于松散的值进行匹配，避免造成编译性能问题或编译异常。'}),"\n",(0,d.jsxs)(n.h3,{id:"编译-npm-包的子依赖",children:["编译 npm 包的子依赖",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#编译-npm-包的子依赖",children:"#"})]}),"\n",(0,d.jsxs)(n.p,{children:["当你通过 ",(0,d.jsx)(n.code,{children:"source.include"})," 编译一个 npm 包时，Builder 默认只会编译匹配到的模块，不会编译对应模块的",(0,d.jsx)(n.strong,{children:"子依赖"}),"。"]}),"\n",(0,d.jsxs)(n.p,{children:["以 ",(0,d.jsx)(n.code,{children:"query-string"})," 为例，它依赖的 ",(0,d.jsx)(n.code,{children:"decode-uri-component"})," 包中同样存在 ES6+ 代码，因此你需要将 ",(0,d.jsx)(n.code,{children:"decode-uri-component"})," 也加入到 ",(0,d.jsx)(n.code,{children:"source.include"})," 中："]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-ts",children:"export default {\n  source: {\n    include: [\n      /\\/node_modules\\/query-string\\//,\n      /\\/node_modules\\/decode-uri-component\\//,\n    ],\n  },\n};\n"})}),"\n",(0,d.jsxs)(n.h3,{id:"编译-monorepo-中的其他库",children:["编译 Monorepo 中的其他库",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#编译-monorepo-中的其他库",children:"#"})]}),"\n",(0,d.jsxs)(n.p,{children:["在 Monorepo 中进行开发时，如果需要引用 Monorepo 中其他库的源代码，也可以直接在 ",(0,d.jsx)(n.code,{children:"source.include"})," 进行配置:"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-ts",children:"import path from 'path';\n\nexport default {\n  source: {\n    include: [\n      // 方法一:\n      // 编译 Monorepo 的 package 目录下的所有文件\n      path.resolve(__dirname, '../../packages'),\n\n      // 方法二:\n      // 编译 Monorepo 的 package 目录里某个包的源代码\n      // 这种写法匹配的范围更加精准，对整体编译性能的影响更小\n      path.resolve(__dirname, '../../packages/xxx/src'),\n    ],\n  },\n};\n"})}),"\n",(0,d.jsxs)(n.h3,{id:"编译-commonjs-模块",children:["编译 CommonJS 模块",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#编译-commonjs-模块",children:"#"})]}),"\n",(0,d.jsxs)(n.p,{children:["Babel 默认无法编译 CommonJS 模块，如果你编译了一个 CommonJS 模块，可能会出现 ",(0,d.jsx)(n.code,{children:"exports is not defined"})," 的运行时报错信息。"]}),"\n",(0,d.jsxs)(n.p,{children:["当你需要使用 ",(0,d.jsx)(n.code,{children:"source.include"})," 来编译 CommonJS 模块时，可以将 Babel 的 ",(0,d.jsx)(n.code,{children:"sourceType"})," 配置设置为 ",(0,d.jsx)(n.code,{children:"unambiguous"}),"："]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-ts",children:"export default {\n  tools: {\n    babel(config) {\n      config.sourceType = 'unambiguous';\n    },\n  },\n};\n"})}),"\n",(0,d.jsxs)(n.p,{children:["将 ",(0,d.jsx)(n.code,{children:"sourceType"})," 设置为 ",(0,d.jsx)(n.code,{children:"unambiguous"})," 可能会产生一些其他影响，请参考 ",(0,d.jsx)(n.a,{href:"https://babeljs.io/docs/en/options#sourcetype",target:"_blank",rel:"noopener noreferrer",children:"Babel 官方文档"}),"。"]}),"\n",(0,d.jsxs)(n.h3,{id:"匹配-symlink",children:["匹配 Symlink",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#匹配-symlink",children:"#"})]}),"\n",(0,d.jsxs)(n.p,{children:["如果你匹配的模块是通过 symlink 链接到当前项目中的，那么需要匹配这个模块的",(0,d.jsx)(n.strong,{children:"真实路径"}),"，而不是 symlink 后的路径。"]}),"\n",(0,d.jsxs)(n.p,{children:["比如，你将 Monorepo 中的 ",(0,d.jsx)(n.code,{children:"packages/foo"})," 路径 symlink 到当前项目的 ",(0,d.jsx)(n.code,{children:"node_modules/foo"})," 路径下，则需要去匹配 ",(0,d.jsx)(n.code,{children:"packages/foo"})," 路径，而不是 ",(0,d.jsx)(n.code,{children:"node_modules/foo"})," 路径。"]}),"\n",(0,d.jsxs)(n.p,{children:["该行为可以通过 webpack 的 ",(0,d.jsx)(n.a,{href:"https://webpack.js.org/configuration/resolve/#resolvesymlinks",target:"_blank",rel:"noopener noreferrer",children:"resolve.symlinks"})," 配置项来进行控制。"]}),"\n",(0,d.jsxs)(n.h3,{id:"注意事项",children:["注意事项",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#注意事项",children:"#"})]}),"\n",(0,d.jsxs)(n.p,{children:["注意，",(0,d.jsx)(n.code,{children:"source.include"})," 不应该被用于编译整个 ",(0,d.jsx)(n.code,{children:"node_modules"})," 目录，比如下面的写法是错误的："]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-ts",children:"export default {\n  source: {\n    include: [/\\/node_modules\\//],\n  },\n};\n"})}),"\n",(0,d.jsxs)(n.p,{children:["如果你对整个 ",(0,d.jsx)(n.code,{children:"node_modules"})," 进行编译，不仅会使编译时间大幅度增加，并且可能会产生不可预期的错误。因为 ",(0,d.jsx)(n.code,{children:"node_modules"})," 中的大部分 npm 包发布的已经是编译后的产物，通常没必要经过二次编译。此外，",(0,d.jsx)(n.code,{children:"core-js"})," 等 npm 包被编译后可能会出现异常。"]})]})}(s=globalThis).__RSPRESS_PAGE_META||(s.__RSPRESS_PAGE_META={}),globalThis.__RSPRESS_PAGE_META["zh%2Fconfig%2Fsource%2Finclude.md"]={toc:[{text:"编译 npm 包",id:"编译-npm-包",depth:3},{text:"编译 npm 包的子依赖",id:"编译-npm-包的子依赖",depth:3},{text:"编译 Monorepo 中的其他库",id:"编译-monorepo-中的其他库",depth:3},{text:"编译 CommonJS 模块",id:"编译-commonjs-模块",depth:3},{text:"匹配 Symlink",id:"匹配-symlink",depth:3},{text:"注意事项",id:"注意事项",depth:3}],title:"",frontmatter:{}};var a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=Object.assign({},(0,l.useMDXComponents)(),e.components).wrapper;return n?(0,d.jsx)(n,(0,i._)((0,c._)({},e),{children:(0,d.jsx)(o,(0,c._)({},e))})):o(e)}},29113:function(e,n,r){"use strict";r.r(n),r.d(n,{default:function(){return a}});var s,c=r("15169"),i=r("43932"),d=r("9880"),l=r("23169");function o(e){var n=Object.assign({ul:"ul",li:"li",strong:"strong",code:"code",p:"p",h3:"h3",a:"a",pre:"pre",img:"img"},(0,l.useMDXComponents)(),e.components);return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"类型："})," ",(0,d.jsx)(n.code,{children:"Array<string | Regexp> | Function"})]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"默认值："})," ",(0,d.jsx)(n.code,{children:"undefined"})]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"打包工具："})," ",(0,d.jsx)(n.code,{children:"仅支持 webpack"})]}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:"限制源代码的引用路径。配置该选项后，所有源文件只能从约定的目录下引用代码，从其他目录引用代码会产生对应的报错提示。"}),"\n",(0,d.jsxs)(n.h3,{id:"示例",children:["示例",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#示例",children:"#"})]}),"\n",(0,d.jsxs)(n.p,{children:["首先我们配置 ",(0,d.jsx)(n.code,{children:"moduleScopes"})," 仅包含 ",(0,d.jsx)(n.code,{children:"src"})," 目录："]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:"export default {\n  source: {\n    moduleScopes: ['./src'],\n  },\n};\n"})}),"\n",(0,d.jsxs)(n.p,{children:["然后在 ",(0,d.jsx)(n.code,{children:"src/App.tsx"})," 中导入 ",(0,d.jsx)(n.code,{children:"src"})," 目录外部的 ",(0,d.jsx)(n.code,{children:"utils/a"})," 模块:"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:"import a from '../utils/a';\n"})}),"\n",(0,d.jsx)(n.p,{children:"在编译时，会提示引用路径错误:"}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.img,{src:"https://lf3-static.bytednsdoc.com/obj/eden-cn/aphqeh7uhohpquloj/modern-js/docs/module-scopes-error.png",alt:"scopes-error"})}),"\n",(0,d.jsxs)(n.p,{children:["通过该选项配置 ",(0,d.jsx)(n.code,{children:"utils"})," 目录，再进行编译，则不会出现错误提示。"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:"export default {\n  source: {\n    moduleScopes: ['./src', './utils'],\n  },\n};\n"})}),"\n",(0,d.jsxs)(n.h3,{id:"array-类型",children:["Array 类型",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#array-类型",children:"#"})]}),"\n",(0,d.jsxs)(n.p,{children:["当 ",(0,d.jsx)(n.code,{children:"moduleScopes"})," 的值为 ",(0,d.jsx)(n.code,{children:"Array"})," 类型时，可以直接设置若干个代码路径，比如添加以下配置："]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:"export default {\n  source: {\n    moduleScopes: ['./src', './shared', './utils'],\n  },\n};\n"})}),"\n",(0,d.jsxs)(n.h3,{id:"function-类型",children:["Function 类型",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#function-类型",children:"#"})]}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"moduleScopes"})," 也支持通过函数的形式来进行修改，避免覆盖默认值："]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:"export default {\n  source: {\n    moduleScopes: scopes => {\n      scopes.push('./shared');\n    },\n  },\n};\n"})})]})}(s=globalThis).__RSPRESS_PAGE_META||(s.__RSPRESS_PAGE_META={}),globalThis.__RSPRESS_PAGE_META["zh%2Fconfig%2Fsource%2FmoduleScopes.md"]={toc:[{text:"示例",id:"示例",depth:3},{text:"Array 类型",id:"array-类型",depth:3},{text:"Function 类型",id:"function-类型",depth:3}],title:"",frontmatter:{}};var a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=Object.assign({},(0,l.useMDXComponents)(),e.components).wrapper;return n?(0,d.jsx)(n,(0,i._)((0,c._)({},e),{children:(0,d.jsx)(o,(0,c._)({},e))})):o(e)}},96281:function(e,n,r){"use strict";r.r(n),r.d(n,{default:function(){return a}});var s,c=r("15169"),i=r("43932"),d=r("9880"),l=r("23169");function o(e){var n=Object.assign({ul:"ul",li:"li",strong:"strong",code:"code",p:"p",h4:"h4",a:"a",pre:"pre"},(0,l.useMDXComponents)(),e.components);return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"类型："})," ",(0,d.jsx)(n.code,{children:"string | string[]"})]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"默认值："})," ",(0,d.jsx)(n.code,{children:"undefined"})]}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:"在每个页面的入口文件前添加一段代码，这段代码会早于页面的代码执行，因此可以用于执行一些全局的代码逻辑，比如注入 polyfill、设置全局样式等。"}),"\n",(0,d.jsxs)(n.h4,{id:"添加单个脚本",children:["添加单个脚本",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#添加单个脚本",children:"#"})]}),"\n",(0,d.jsxs)(n.p,{children:["首先创建一个 ",(0,d.jsx)(n.code,{children:"src/polyfill.ts"})," 文件："]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:"console.log('I am a polyfill');\n"})}),"\n",(0,d.jsxs)(n.p,{children:["然后将 ",(0,d.jsx)(n.code,{children:"src/polyfill.ts"})," 配置到 ",(0,d.jsx)(n.code,{children:"source.preEntry"})," 上："]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:"export default {\n  source: {\n    preEntry: './src/polyfill.ts',\n  },\n};\n"})}),"\n",(0,d.jsxs)(n.p,{children:["重新运行编译并访问任意页面，可以看到 ",(0,d.jsx)(n.code,{children:"src/polyfill.ts"})," 中的代码已经执行，并在 console 中输出了对应的内容。"]}),"\n",(0,d.jsxs)(n.h4,{id:"添加全局样式",children:["添加全局样式",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#添加全局样式",children:"#"})]}),"\n",(0,d.jsxs)(n.p,{children:["你也可以通过 ",(0,d.jsx)(n.code,{children:"source.preEntry"})," 来配置全局样式，这段 CSS 代码会早于页面代码加载，比如引入一个 ",(0,d.jsx)(n.code,{children:"normalize.css"})," 文件："]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:"export default {\n  source: {\n    preEntry: './src/normalize.css',\n  },\n};\n"})}),"\n",(0,d.jsxs)(n.h4,{id:"添加多个脚本",children:["添加多个脚本",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#添加多个脚本",children:"#"})]}),"\n",(0,d.jsxs)(n.p,{children:["你可以将 ",(0,d.jsx)(n.code,{children:"preEntry"})," 设置为数组来添加多个脚本，它们会按数组顺序执行："]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:"export default {\n  source: {\n    preEntry: ['./src/polyfill-a.ts', './src/polyfill-b.ts'],\n  },\n};\n"})})]})}(s=globalThis).__RSPRESS_PAGE_META||(s.__RSPRESS_PAGE_META={}),globalThis.__RSPRESS_PAGE_META["zh%2Fconfig%2Fsource%2FpreEntry.md"]={toc:[{text:"添加单个脚本",id:"添加单个脚本",depth:4},{text:"添加全局样式",id:"添加全局样式",depth:4},{text:"添加多个脚本",id:"添加多个脚本",depth:4}],title:"",frontmatter:{}};var a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=Object.assign({},(0,l.useMDXComponents)(),e.components).wrapper;return n?(0,d.jsx)(n,(0,i._)((0,c._)({},e),{children:(0,d.jsx)(o,(0,c._)({},e))})):o(e)}},61635:function(e,n,r){"use strict";r.r(n),r.d(n,{default:function(){return a}});var s,c=r("15169"),i=r("43932"),d=r("9880"),l=r("23169");function o(e){var n=Object.assign({ul:"ul",li:"li",strong:"strong",code:"code",p:"p",a:"a",h3:"h3",pre:"pre",h4:"h4"},(0,l.useMDXComponents)(),e.components);return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"类型："})," ",(0,d.jsx)(n.code,{children:"string | Record<BuilderTarget, string>"})]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"默认值："})," ",(0,d.jsx)(n.code,{children:"undefined"})]}),"\n"]}),"\n",(0,d.jsxs)(n.p,{children:["用于为 ",(0,d.jsx)(n.a,{href:"https://webpack.js.org/configuration/resolve/#resolveextensions",target:"_blank",rel:"noopener noreferrer",children:"resolve.extensions"})," 添加统一的前缀。"]}),"\n",(0,d.jsx)(n.p,{children:"如果多个文件拥有相同的名称，但具有不同的文件后缀，Builder 会根据 extensions 数组的顺序进行识别，解析数组中第一个被识别的文件，并跳过其余文件。"}),"\n",(0,d.jsxs)(n.h3,{id:"示例",children:["示例",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#示例",children:"#"})]}),"\n",(0,d.jsxs)(n.p,{children:["下面是配置 ",(0,d.jsx)(n.code,{children:".web"})," 前缀的例子。"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:"export default {\n  source: {\n    resolveExtensionPrefix: '.web',\n  },\n};\n"})}),"\n",(0,d.jsx)(n.p,{children:"配置完成后，extensions 数组会发生以下变化："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:"// 配置前\nconst extensions = ['.js', '.ts', ...];\n\n// 配置后\nconst extensions = ['.web.js', '.js', '.web.ts' , '.ts', ...];\n"})}),"\n",(0,d.jsxs)(n.p,{children:["在代码中 ",(0,d.jsx)(n.code,{children:"import './foo'"})," 时，会优先识别 ",(0,d.jsx)(n.code,{children:"foo.web.js"})," 文件，再识别 ",(0,d.jsx)(n.code,{children:"foo.js"})," 文件。"]}),"\n",(0,d.jsxs)(n.h4,{id:"根据产物类型设置",children:["根据产物类型设置",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#根据产物类型设置",children:"#"})]}),"\n",(0,d.jsxs)(n.p,{children:["当你同时构建多种类型的产物时，你可以为不同的产物类型设置不同的 extension 前缀。此时，你需要把 ",(0,d.jsx)(n.code,{children:"resolveExtensionPrefix"})," 设置为一个对象，对象的 key 为对应的产物类型。"]}),"\n",(0,d.jsxs)(n.p,{children:["比如为 ",(0,d.jsx)(n.code,{children:"web"})," 和 ",(0,d.jsx)(n.code,{children:"node"})," 设置不同的 extension 前缀："]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:"export default {\n  output: {\n    source: {\n      resolveExtensionPrefix: {\n        web: '.web',\n        node: '.node',\n      },\n    },\n  },\n};\n"})}),"\n",(0,d.jsxs)(n.p,{children:["在代码中 ",(0,d.jsx)(n.code,{children:"import './foo'"})," 时，对于 node 产物，会优先识别 ",(0,d.jsx)(n.code,{children:"foo.node.js"})," 文件，而对于 web 产物，则会优先识别 ",(0,d.jsx)(n.code,{children:"foo.web.js"})," 文件。"]})]})}(s=globalThis).__RSPRESS_PAGE_META||(s.__RSPRESS_PAGE_META={}),globalThis.__RSPRESS_PAGE_META["zh%2Fconfig%2Fsource%2FresolveExtensionPrefix.md"]={toc:[{text:"示例",id:"示例",depth:3},{text:"根据产物类型设置",id:"根据产物类型设置",depth:4}],title:"",frontmatter:{}};var a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=Object.assign({},(0,l.useMDXComponents)(),e.components).wrapper;return n?(0,d.jsx)(n,(0,i._)((0,c._)({},e),{children:(0,d.jsx)(o,(0,c._)({},e))})):o(e)}},28202:function(e,n,r){"use strict";r.r(n),r.d(n,{default:function(){return a}});var s,c=r("15169"),i=r("43932"),d=r("9880"),l=r("23169");function o(e){var n=Object.assign({ul:"ul",li:"li",strong:"strong",pre:"pre",code:"code",p:"p",a:"a",h3:"h3",h4:"h4"},(0,l.useMDXComponents)(),e.components);return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.strong,{children:"类型："})}),"\n"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-ts",children:"type Fields = (string | string[])[];\n\ntype ResolveMainFields = Fields | Record<BuilderTarget, Fields>;\n"})}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"默认值："})," ",(0,d.jsx)(n.code,{children:"undefined"})]}),"\n"]}),"\n",(0,d.jsxs)(n.p,{children:["该配置项将决定你使用 ",(0,d.jsx)(n.code,{children:"package.json"})," 哪个字段导入 ",(0,d.jsx)(n.code,{children:"npm"})," 模块。对应 webpack 的 ",(0,d.jsx)(n.a,{href:"https://webpack.js.org/configuration/resolve/#resolvemainfields",target:"_blank",rel:"noopener noreferrer",children:"resolve.mainFields"})," 配置。"]}),"\n",(0,d.jsxs)(n.h3,{id:"示例",children:["示例",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#示例",children:"#"})]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:"export default {\n  source: {\n    resolveMainFields: ['main', 'browser', 'exports'],\n  },\n};\n"})}),"\n",(0,d.jsxs)(n.h4,{id:"根据产物类型设置",children:["根据产物类型设置",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#根据产物类型设置",children:"#"})]}),"\n",(0,d.jsxs)(n.p,{children:["当你同时构建多种类型的产物时，你可以为不同的产物类型设置不同的 mainFields。此时，你需要把 ",(0,d.jsx)(n.code,{children:"resolveMainFields"})," 设置为一个对象，对象的 key 为对应的产物类型。"]}),"\n",(0,d.jsxs)(n.p,{children:["比如为 ",(0,d.jsx)(n.code,{children:"web"})," 和 ",(0,d.jsx)(n.code,{children:"node"})," 设置不同的 mainFields："]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:"export default {\n  output: {\n    source: {\n      resolveMainFields: {\n        web: ['main', 'browser', 'exports'],\n        node: ['main', 'node', 'exports'],\n      },\n    },\n  },\n};\n"})})]})}(s=globalThis).__RSPRESS_PAGE_META||(s.__RSPRESS_PAGE_META={}),globalThis.__RSPRESS_PAGE_META["zh%2Fconfig%2Fsource%2FresolveMainFields.md"]={toc:[{text:"示例",id:"示例",depth:3},{text:"根据产物类型设置",id:"根据产物类型设置",depth:4}],title:"",frontmatter:{}};var a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=Object.assign({},(0,l.useMDXComponents)(),e.components).wrapper;return n?(0,d.jsx)(n,(0,i._)((0,c._)({},e),{children:(0,d.jsx)(o,(0,c._)({},e))})):o(e)}},53035:function(e,n,r){"use strict";r.r(n),r.d(n,{default:function(){return a}});var s,c=r("15169"),i=r("43932"),d=r("9880"),l=r("23169");function o(e){var n=Object.assign({p:"p",a:"a",code:"code",ul:"ul",li:"li",strong:"strong",pre:"pre",div:"div",h3:"h3",h4:"h4"},(0,l.useMDXComponents)(),e.components);return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(n.p,{children:["用于按需引入组件库的代码和样式，能力等价于 ",(0,d.jsx)(n.a,{href:"https://www.npmjs.com/package/babel-plugin-import",target:"_blank",rel:"noopener noreferrer",children:"babel-plugin-import"}),"。"]}),"\n",(0,d.jsxs)(n.p,{children:["它与 ",(0,d.jsx)(n.a,{href:"https://www.npmjs.com/package/babel-plugin-import",target:"_blank",rel:"noopener noreferrer",children:"babel-plugin-import"})," 的区别在于，",(0,d.jsx)(n.code,{children:"source.transformImport"})," 不与 Babel 耦合。Builder 会自动识别当前使用的编译工具是 Babel、SWC 还是 Rspack，并添加相应的按需引入配置。"]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.strong,{children:"类型："})}),"\n"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-ts",children:"type Config =\n  | false\n  | Array<{\n      libraryName: string;\n      libraryDirectory?: string;\n      style?: string | boolean;\n      styleLibraryDirectory?: string;\n      camelToDashComponentName?: boolean;\n      transformToDefaultImport?: boolean;\n      customName?: ((member: string) => string | undefined) | string;\n      customStyleName?: ((member: string) => string | undefined) | string;\n    }>;\n"})}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.strong,{children:"默认值："})}),"\n"]}),"\n",(0,d.jsxs)(n.p,{children:["当项目中安装了 ",(0,d.jsx)(n.a,{href:"https://www.npmjs.com/package/antd",target:"_blank",rel:"noopener noreferrer",children:"Ant Design 组件库"})," <= 4.x 版本时，Builder 会自动添加以下默认配置："]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:"const defaultAntdConfig = {\n  libraryName: 'antd',\n  libraryDirectory: isServer ? 'lib' : 'es',\n  style: true,\n};\n"})}),"\n",(0,d.jsxs)(n.p,{children:["当项目中安装了 ",(0,d.jsx)(n.a,{href:"https://www.npmjs.com/package/@arco-design/web-react",target:"_blank",rel:"noopener noreferrer",children:"Arco Design 组件库"})," 时，Builder 会自动添加以下默认配置："]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:"const defaultArcoConfig = [\n  {\n    libraryName: '@arco-design/web-react',\n    libraryDirectory: isServer ? 'lib' : 'es',\n    camelToDashComponentName: false,\n    style: true,\n  },\n  {\n    libraryName: '@arco-design/web-react/icon',\n    libraryDirectory: isServer ? 'react-icon-cjs' : 'react-icon',\n    camelToDashComponentName: false,\n  },\n];\n"})}),"\n",(0,d.jsxs)(n.div,{className:"modern-directive tip",children:[(0,d.jsx)(n.div,{className:"modern-directive-title",children:"TIP"}),(0,d.jsx)(n.div,{className:"modern-directive-content",children:(0,d.jsxs)(n.p,{children:["当你添加了 ",(0,d.jsx)(n.code,{children:"antd"})," 或 ",(0,d.jsx)(n.code,{children:"@arco-design/web-react"})," 相关的配置时，优先级会高于上述默认配置。\n"]})})]}),"\n",(0,d.jsxs)(n.h3,{id:"示例",children:["示例",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#示例",children:"#"})]}),"\n",(0,d.jsx)(n.p,{children:"当使用上述 antd 默认配置："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:"export default {\n  source: {\n    transformImport: [\n      {\n        libraryName: 'antd',\n        libraryDirectory: 'es',\n        style: true,\n      },\n    ],\n  },\n};\n"})}),"\n",(0,d.jsx)(n.p,{children:"源代码如下："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:"import { Button } from 'antd';\n"})}),"\n",(0,d.jsx)(n.p,{children:"会被转换成："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:"import Button from 'antd/es/button';\nimport 'antd/es/button/style';\n"})}),"\n",(0,d.jsxs)(n.h3,{id:"禁用默认配置",children:["禁用默认配置",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#禁用默认配置",children:"#"})]}),"\n",(0,d.jsxs)(n.p,{children:["你可以手动设置 ",(0,d.jsx)(n.code,{children:"transformImport: false"})," 来关掉 transformImport 的默认行为。"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:"export default {\n  source: {\n    transformImport: false,\n  },\n};\n"})}),"\n",(0,d.jsxs)(n.p,{children:["比如，当你使用了 ",(0,d.jsx)(n.code,{children:"externals"})," 来避免打包 antd 时，由于 ",(0,d.jsx)(n.code,{children:"transformImport"})," 默认会转换 antd 的引用路径，导致匹配的路径发生了变化，因此 externals 无法正确生效，此时你可以设置关闭 ",(0,d.jsx)(n.code,{children:"transformImport"})," 来避免该问题。"]}),"\n",(0,d.jsxs)(n.h3,{id:"配置",children:["配置",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#配置",children:"#"})]}),"\n",(0,d.jsxs)(n.h4,{id:"libraryname",children:["libraryName",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#libraryname",children:"#"})]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"类型："})," ",(0,d.jsx)(n.code,{children:"string"})]}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:"用于指定需要按需加载的模块名称。当 Builder 遍历代码时，如果遇到了对应模块的 import 语句，则会对其进行转换。"}),"\n",(0,d.jsxs)(n.h4,{id:"librarydirectory",children:["libraryDirectory",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#librarydirectory",children:"#"})]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"类型："})," ",(0,d.jsx)(n.code,{children:"string"})]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"默认值："})," ",(0,d.jsx)(n.code,{children:"'lib'"})]}),"\n"]}),"\n",(0,d.jsxs)(n.p,{children:["用于拼接转换后的路径，拼接规则为 ",(0,d.jsx)(n.code,{children:"${libraryName}/${libraryDirectory}/${member}"}),"，其中 member 为引入成员。"]}),"\n",(0,d.jsx)(n.p,{children:"示例："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-ts",children:"import { Button } from 'foo';\n"})}),"\n",(0,d.jsx)(n.p,{children:"转换结果:"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-ts",children:"import Button from 'foo/lib/button';\n"})}),"\n",(0,d.jsxs)(n.h4,{id:"style",children:["style",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#style",children:"#"})]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"类型："})," ",(0,d.jsx)(n.code,{children:"boolean"})]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"默认值："})," ",(0,d.jsx)(n.code,{children:"undefined"})]}),"\n"]}),"\n",(0,d.jsxs)(n.p,{children:["确定是否需要引入相关样式，若为 ",(0,d.jsx)(n.code,{children:"true"}),"，则会引入路径 ",(0,d.jsx)(n.code,{children:"${libraryName}/${libraryDirectory}/${member}/style"}),"。\n若为 ",(0,d.jsx)(n.code,{children:"false"})," 或 ",(0,d.jsx)(n.code,{children:"undefined"})," 则不会引入样式。"]}),"\n",(0,d.jsxs)(n.p,{children:["当配置为 ",(0,d.jsx)(n.code,{children:"true"})," 时："]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-ts",children:"import { Button } from 'foo';\n"})}),"\n",(0,d.jsx)(n.p,{children:"转换结果:"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-ts",children:"import Button from 'foo/lib/button';\nimport 'foo/lib/button/style';\n"})}),"\n",(0,d.jsxs)(n.h4,{id:"stylelibrarydirectory",children:["styleLibraryDirectory",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#stylelibrarydirectory",children:"#"})]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"类型："})," ",(0,d.jsx)(n.code,{children:"string"})]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"默认值："})," ",(0,d.jsx)(n.code,{children:"undefined"})]}),"\n"]}),"\n",(0,d.jsxs)(n.p,{children:["该配置用于拼接引入样式时的引入路径，若该配置被指定，则 ",(0,d.jsx)(n.code,{children:"style"})," 配置项会被忽略。拼接引入路径为 ",(0,d.jsx)(n.code,{children:"${libraryName}/${styleLibraryDirectory}/${member}"}),"。"]}),"\n",(0,d.jsxs)(n.p,{children:["当配置为 ",(0,d.jsx)(n.code,{children:"styles"})," 时："]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-ts",children:"import { Button } from 'foo';\n"})}),"\n",(0,d.jsx)(n.p,{children:"转换结果:"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-ts",children:"import Button from 'foo/lib/button';\nimport 'foo/styles/button';\n"})}),"\n",(0,d.jsxs)(n.h4,{id:"cameltodashcomponentname",children:["camelToDashComponentName",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#cameltodashcomponentname",children:"#"})]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"类型："})," ",(0,d.jsx)(n.code,{children:"boolean"})]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"默认值："})," ",(0,d.jsx)(n.code,{children:"true"})]}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:"是否需要将 camelCase 的引入转换成 kebab-case。"}),"\n",(0,d.jsx)(n.p,{children:"示例："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-ts",children:"import { ButtonGroup } from 'foo';\n"})}),"\n",(0,d.jsx)(n.p,{children:"转换结果："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-ts",children:"// 设置成 true：\nimport ButtonGroup from 'foo/button-group';\n// 设置成 false：\nimport ButtonGroup from 'foo/ButtonGroup';\n"})}),"\n",(0,d.jsxs)(n.h4,{id:"transformtodefaultimport",children:["transformToDefaultImport",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#transformtodefaultimport",children:"#"})]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"类型："})," ",(0,d.jsx)(n.code,{children:"boolean"})]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"默认值："})," ",(0,d.jsx)(n.code,{children:"true"})]}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:"是否将导入语句转换成默认导入。"}),"\n",(0,d.jsx)(n.p,{children:"示例："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-ts",children:"import { Button } from 'foo';\n"})}),"\n",(0,d.jsx)(n.p,{children:"转换结果："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-ts",children:"// 设置成 true：\nimport Button from 'foo/button';\n// 设置成 false：\nimport { Button } from 'foo/button';\n"})}),"\n",(0,d.jsxs)(n.h4,{id:"customname",children:["customName",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#customname",children:"#"})]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"类型："})," ",(0,d.jsx)(n.code,{children:"((member: string) => string | undefined) | string"})]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"默认值："})," ",(0,d.jsx)(n.code,{children:"undefined"})]}),"\n"]}),"\n",(0,d.jsxs)(n.div,{className:"modern-directive tip",children:[(0,d.jsx)(n.div,{className:"modern-directive-title",children:"注意"}),(0,d.jsxs)(n.div,{className:"modern-directive-content",children:["\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"函数类型的配置只能在 Webpack 构建中使用。"}),"\n",(0,d.jsx)(n.li,{children:"模版类型的配置只能在 Rspack 构建或者使用了 SWC 的 Webpack 构建中使用。"}),"\n"]}),"\n"]})]}),"\n",(0,d.jsxs)(n.p,{children:["自定义转换后的导入路径，输入是引入的成员，例如配置成 ",(0,d.jsx)(n.code,{children:" (member) => `my-lib/${member}` "}),"，会将 ",(0,d.jsx)(n.code,{children:"import { foo } from 'bar'"})," 转换成 ",(0,d.jsx)(n.code,{children:"import foo from 'my-lib/foo'"}),"。"]}),"\n",(0,d.jsxs)(n.p,{children:["在使用 Rspack 构建时，不能使用函数配置，但可以使用 ",(0,d.jsx)(n.a,{href:"https://handlebarsjs.com/",target:"_blank",rel:"noopener noreferrer",children:"handlebars"})," 模版字符串，对于上面的函数配置，在使用模版字符串时可以用以下模版代替 ",(0,d.jsx)(n.code,{children:"my-lib/{{ member }}"}),"，也可以使用一些内置帮助方法，例如 ",(0,d.jsx)(n.code,{children:"my-lib/{{ kebabCase member }}"})," 来转换成 kebab-case 格式，除了 kebabCase 以外还有 camelCase，snakeCase，upperCase，lowerCase 可以使用。"]}),"\n",(0,d.jsxs)(n.h4,{id:"customstylename",children:["customStyleName",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#customstylename",children:"#"})]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"类型："})," ",(0,d.jsx)(n.code,{children:"((member: string) => string | undefined) | string"})]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"默认值："})," ",(0,d.jsx)(n.code,{children:"undefined"})]}),"\n"]}),"\n",(0,d.jsxs)(n.div,{className:"modern-directive tip",children:[(0,d.jsx)(n.div,{className:"modern-directive-title",children:"注意"}),(0,d.jsxs)(n.div,{className:"modern-directive-content",children:["\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"函数类型的配置只能在 Webpack 构建中使用。"}),"\n",(0,d.jsx)(n.li,{children:"模版类型的配置只能在 Rspack 构建或者使用了 SWC 的 Webpack 构建中使用。"}),"\n"]}),"\n"]})]}),"\n",(0,d.jsxs)(n.p,{children:["自定义转换后的样式导入路径，输入是引入的成员，例如配置成 ",(0,d.jsx)(n.code,{children:" (member) => `my-lib/${member}` "}),"，会将 ",(0,d.jsx)(n.code,{children:"import { foo } from 'bar'"})," 转换成 ",(0,d.jsx)(n.code,{children:"import foo from 'my-lib/foo'"}),"。"]}),"\n",(0,d.jsxs)(n.p,{children:["在使用 Rspack 构建时，不能使用函数配置，但可以使用 ",(0,d.jsx)(n.a,{href:"https://handlebarsjs.com/",target:"_blank",rel:"noopener noreferrer",children:"handlebars"})," 模版字符串，对于上面的函数配置，在使用模版字符串时可以用以下模版代替 ",(0,d.jsx)(n.code,{children:"my-lib/{{ member }}"}),"，也可以使用一些内置帮助方法，例如 ",(0,d.jsx)(n.code,{children:"my-lib/{{ kebabCase member }}"})," 来转换成 kebab-case 格式，除了 kebabCase 以外还有 camelCase，snakeCase，upperCase，lowerCase 可以使用。"]})]})}(s=globalThis).__RSPRESS_PAGE_META||(s.__RSPRESS_PAGE_META={}),globalThis.__RSPRESS_PAGE_META["zh%2Fconfig%2Fsource%2FtransformImport.md"]={toc:[{text:"示例",id:"示例",depth:3},{text:"禁用默认配置",id:"禁用默认配置",depth:3},{text:"配置",id:"配置",depth:3},{text:"libraryName",id:"libraryname",depth:4},{text:"libraryDirectory",id:"librarydirectory",depth:4},{text:"style",id:"style",depth:4},{text:"styleLibraryDirectory",id:"stylelibrarydirectory",depth:4},{text:"camelToDashComponentName",id:"cameltodashcomponentname",depth:4},{text:"transformToDefaultImport",id:"transformtodefaultimport",depth:4},{text:"customName",id:"customname",depth:4},{text:"customStyleName",id:"customstylename",depth:4}],title:"",frontmatter:{}};var a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=Object.assign({},(0,l.useMDXComponents)(),e.components).wrapper;return n?(0,d.jsx)(n,(0,i._)((0,c._)({},e),{children:(0,d.jsx)(o,(0,c._)({},e))})):o(e)}}}]);