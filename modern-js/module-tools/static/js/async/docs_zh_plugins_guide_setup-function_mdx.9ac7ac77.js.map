{"version":3,"file":"static/js/async/docs_zh_plugins_guide_setup-function_mdx.9ac7ac77.js","sources":["./docs/zh/plugins/guide/setup-function.mdx"],"sourcesContent":["globalThis.__RSPRESS_PAGE_META ||= {};\nglobalThis.__RSPRESS_PAGE_META[\"zh%2Fplugins%2Fguide%2Fsetup-function.mdx\"] = {\"toc\":[{\"text\":\"插件 API 对象\",\"id\":\"插件-api-对象\",\"depth\":2},{\"text\":\"api.useAppContext\",\"id\":\"apiuseappcontext\",\"depth\":3},{\"text\":\"api.useResolvedConfigContext\",\"id\":\"apiuseresolvedconfigcontext\",\"depth\":3},{\"text\":\"api.useHookRunners\",\"id\":\"apiusehookrunners\",\"depth\":3},{\"text\":\"异步 setup\",\"id\":\"异步-setup\",\"depth\":2},{\"text\":\"生命周期钩子\",\"id\":\"生命周期钩子\",\"depth\":2}],\"title\":\"Setup 函数\",\"frontmatter\":{\"sidebar_position\":3}};\nimport { useMDXComponents as _provideComponents } from \"@mdx-js/react\";\nfunction _createMdxContent(props) {\n    const _components = Object.assign({\n        h1: \"h1\",\n        a: \"a\",\n        p: \"p\",\n        code: \"code\",\n        h2: \"h2\",\n        pre: \"pre\",\n        h3: \"h3\",\n        div: \"div\",\n        ul: \"ul\",\n        li: \"li\"\n    }, _provideComponents(), props.components);\n    return <><_components.h1 id=\"setup-函数\">{\"Setup 函数\"}<_components.a className=\"header-anchor\" aria-hidden=\"true\" href=\"#setup-函数\">{\"#\"}</_components.a></_components.h1>{\"\\n\"}<_components.p>{\"在\"}<_components.a href=\"/plugins/guide/plugin-object\">{\"「插件对象」\"}</_components.a>{\" 部分我们知道插件对象包含了一个 \"}<_components.code>{\"setup\"}</_components.code>{\" 函数，该函数不仅包含了一个 \"}<_components.code>{\"api\"}</_components.code>{\" 对象参数，同时还可以返回一个 Hooks 对象。\"}</_components.p>{\"\\n\"}<_components.h2 id=\"插件-api-对象\">{\"插件 API 对象\"}<_components.a className=\"header-anchor\" aria-hidden=\"true\" href=\"#插件-api-对象\">{\"#\"}</_components.a></_components.h2>{\"\\n\"}<_components.p>{\"插件的 \"}<_components.code>{\"setup\"}</_components.code>{\" 函数会提供一个 \"}<_components.code>{\"api\"}</_components.code>{\" 对象参数，你可以调用该对象上提供的一些方法来获取到配置、项目上下文等信息。\"}</_components.p>{\"\\n\"}<_components.pre><_components.code className=\"language-ts\">{\"export const myPlugin = (): CliPlugin<ModuleTools> => ({\\n  name: 'my-plugin',\\n\\n  setup(api) {\\n    // 获取应用原始配置\\n    const config = api.useConfigContext();\\n    // 获取应用运行上下文\\n    const appContext = api.useAppContext();\\n    // 获取解析之后的最终配置\\n    const resolvedConfig = api.useResolvedConfigContext();\\n  },\\n});\\n\"}</_components.code></_components.pre>{\"\\n\"}<_components.h3 id=\"apiuseappcontext\"><_components.code>{\"api.useAppContext\"}</_components.code><_components.a className=\"header-anchor\" aria-hidden=\"true\" href=\"#apiuseappcontext\">{\"#\"}</_components.a></_components.h3>{\"\\n\"}<_components.p>{\"用于获取项目上下文信息。\"}</_components.p>{\"\\n\"}<_components.pre><_components.code className=\"language-ts\">{\"const useAppContext: () => IAppContext;\\n\\ninterface IAppContext {\\n  appDirectory: string;\\n  configFile: string | false;\\n  packageName: string;\\n  nodeModulesDirectory: string;\\n  internalDirectory: string;\\n  plugins: {\\n    cli?: any;\\n    server?: any;\\n  }[];\\n}\\n\"}</_components.code></_components.pre>{\"\\n\"}<_components.div className=\"modern-directive info\"><_components.div className=\"modern-directive-title\">{\"INFO\"}</_components.div><_components.div className=\"modern-directive-content\"><_components.p>{\"通过实际的类型文件我们可以看到还存在着其他的字段，不过目前对于模块工程有意义的字段只有以上内容。api 对象其他的方法也是如此。\"}</_components.p></_components.div></_components.div>{\"\\n\"}<_components.h3 id=\"apiuseresolvedconfigcontext\"><_components.code>{\"api.useResolvedConfigContext\"}</_components.code><_components.a className=\"header-anchor\" aria-hidden=\"true\" href=\"#apiuseresolvedconfigcontext\">{\"#\"}</_components.a></_components.h3>{\"\\n\"}<_components.p>{\"用于获取解析之后的最终配置。\"}</_components.p>{\"\\n\"}<_components.div className=\"modern-directive info\"><_components.div className=\"modern-directive-title\">{\"INFO\"}</_components.div><_components.div className=\"modern-directive-content\"><_components.p>{\"如果需要获取构建相关的最终配置，需要使用 \"}<_components.a href=\"/\"><_components.code>{\"beforeBuild\"}</_components.code></_components.a>{\" Hook。\\n\"}</_components.p></_components.div></_components.div>{\"\\n\"}<_components.pre><_components.code className=\"language-ts\">{\"const useResolvedConfigContext: () => NormalizedConfig;\\n\\ninterface NormalizedConfig {\\n  buildConfig: PartialBuildConfig;\\n  buildPreset: BuildPreset;\\n  dev: Dev;\\n  plugins: PluginConfig;\\n  runtime: RuntimeConfig;\\n  runtimeByEntries?: RuntimeByEntriesConfig;\\n  _raw: UserConfig;\\n}\\n\"}</_components.code></_components.pre>{\"\\n\"}<_components.h3 id=\"apiusehookrunners\"><_components.code>{\"api.useHookRunners\"}</_components.code><_components.a className=\"header-anchor\" aria-hidden=\"true\" href=\"#apiusehookrunners\">{\"#\"}</_components.a></_components.h3>{\"\\n\"}<_components.p>{\"用于获取 Hooks 的执行器，并触发特定的 Hook 执行。\"}</_components.p>{\"\\n\"}<_components.pre><_components.code className=\"language-ts\">{\"import type { CliPlugin } from '@modern-js/core';\\n\\nexport const myPlugin = (): CliPlugin => ({\\n  name: 'my-plugin',\\n\\n  async setup(api) {\\n    const hookRunners = api.useHookRunners();\\n    // 触发 afterBuild Hook\\n    await hookRunners.afterBuild();\\n  },\\n});\\n\"}</_components.code></_components.pre>{\"\\n\"}<_components.h2 id=\"异步-setup\">{\"异步 setup\"}<_components.a className=\"header-anchor\" aria-hidden=\"true\" href=\"#异步-setup\">{\"#\"}</_components.a></_components.h2>{\"\\n\"}<_components.p>{\"CLI 插件的 setup 可以是一个异步函数，在初始化过程中执行异步逻辑。\"}</_components.p>{\"\\n\"}<_components.pre><_components.code className=\"language-ts\">{\"export const myPlugin = (): CliPlugin<ModuleTools> => ({\\n  name: 'my-plugin',\\n\\n  async setup(api) {\\n    await doSomething();\\n  },\\n});\\n\"}</_components.code></_components.pre>{\"\\n\"}<_components.h2 id=\"生命周期钩子\">{\"生命周期钩子\"}<_components.a className=\"header-anchor\" aria-hidden=\"true\" href=\"#生命周期钩子\">{\"#\"}</_components.a></_components.h2>{\"\\n\"}<_components.p>{\"我们知道 \"}<_components.code>{\"setup\"}</_components.code>{\" 函数会返回一个 Hooks 对象，所谓 Hooks 对象也可以理解是具有 Module Tools 生命周期钩子的对象。\"}</_components.p>{\"\\n\"}<_components.p>{\"目前主要包含两类钩子：\"}</_components.p>{\"\\n\"}<_components.ul>{\"\\n\"}<_components.li>{\"构建钩子：仅在执行 \"}<_components.code>{\"build\"}</_components.code>{\" 命令构建源码产物时触发。\"}</_components.li>{\"\\n\"}<_components.li><_components.code>{\"buildPlatform\"}</_components.code>{\" 钩子：仅在执行 \"}<_components.code>{\"build --platform\"}</_components.code>{\" 命令生成其他构建产物时触发。\"}</_components.li>{\"\\n\"}<_components.li>{\"调试钩子：运行 \"}<_components.code>{\"dev\"}</_components.code>{\" 命令时会触发的钩子。\"}</_components.li>{\"\\n\"}</_components.ul>{\"\\n\"}<_components.p>{\"关于生命周期钩子的完整列表参考 \"}<_components.a href=\"/api/plugin-api/plugin-hooks\">{\"API 文档\"}</_components.a>{\"。\"}</_components.p></>;\n}\nfunction MDXContent(props = {}) {\n    const { wrapper: MDXLayout } = Object.assign({}, _provideComponents(), props.components);\n    return MDXLayout ? <MDXLayout {...props}><_createMdxContent {...props}/></MDXLayout> : _createMdxContent(props);\n}\nexport default MDXContent;\n"],"names":["_createMdxContent","props","_components","Object","assign","h1","a","p","code","h2","pre","h3","div","ul","li","components","id","className","href","globalThis","__RSPRESS_PAGE_META","MDXLayout","wrapper","_"],"mappings":"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"}