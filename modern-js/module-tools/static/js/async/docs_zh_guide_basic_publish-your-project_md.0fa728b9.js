(self.webpackChunk_modern_js_module_tools_docs=self.webpackChunk_modern_js_module_tools_docs||[]).push([["docs_zh_guide_basic_publish-your-project_md"],{43492:function(e,n,r){"use strict";r.r(n),r.d(n,{default:function(){return h}});var s,d=r("15169"),c=r("43932"),i=r("9880"),a=r("23169");function l(e){var n=Object.assign({h1:"h1",a:"a",p:"p",ul:"ul",li:"li",h2:"h2",strong:"strong",code:"code",pre:"pre",blockquote:"blockquote"},(0,a.useMDXComponents)(),e.components);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.h1,{id:"版本管理与发布",children:["版本管理与发布",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#版本管理与发布",children:"#"})]}),"\n",(0,i.jsx)(n.p,{children:"一个 npm 类型的模块项目发布流程包含了两个阶段："}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"第一阶段是在开发期间，开发者需要提供变更文件，该文件记录了在发布期间需要的变更内容；"}),"\n",(0,i.jsxs)(n.li,{children:["第二阶段是在发布期间，Module Tools 会收集所有的变更文件来更新版本、更新发布日志，并发布新的包到 ",(0,i.jsx)(n.a,{href:"https://www.npmjs.com/",target:"_blank",rel:"noopener noreferrer",children:"npm Registry"})," 上。"]}),"\n"]}),"\n",(0,i.jsxs)(n.h2,{id:"跟踪变更",children:["跟踪变更",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#跟踪变更",children:"#"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"当项目发生变化的时候需要将变化的内容记录下来"}),"。项目发生的变化一般是指："]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"新功能"}),"\n",(0,i.jsx)(n.li,{children:"修复问题"}),"\n",(0,i.jsx)(n.li,{children:"配置文件修改"}),"\n",(0,i.jsx)(n.li,{children:"..."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"当这些任务一旦开发完成后，需要通过以下命令来对当前的变化进行记录："}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/guide/basic/command-preview#modern-change",children:(0,i.jsx)(n.code,{children:"modern change"})})}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["执行 ",(0,i.jsx)(n.code,{children:"modern change"})," 命令后会向开发者提出几个问题，并根据开发者的回答生成变更记录。变更记录文件包含了版本变化的类型和其描述，该文件会被提交到 git 仓库中。"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ npx modern change\n\uD83E\uDD8B  What kind of change is this for module-example? (current version is 0.1.0) \xb7 patch\n\uD83E\uDD8B  Please enter a summary for this change (this will be in the changelogs). Submit empty line to open external editor\n\uD83E\uDD8B  Summary \xb7 publish test\n\uD83E\uDD8B  === Releasing the following packages ===\n\uD83E\uDD8B  [Patch]\n\uD83E\uDD8B    module\n\uD83E\uDD8B  Is this your desired changeset? (Y/n) \xb7 true\n\uD83E\uDD8B  Changeset added! - you can now commit it\n\uD83E\uDD8B\n\uD83E\uDD8B  If you want to modify or expand on the changeset summary, you can find it here\n\uD83E\uDD8B  info /xxxxxx/module/.changeset/brave-dryers-agree.md\n"})}),"\n",(0,i.jsxs)(n.p,{children:["当执行成功后，生成的包含变更记录的 Markdown 文件会保存在项目的 ",(0,i.jsx)(n.code,{children:".changeset"})," 目录下面。其内容类似下面这样："]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-markdown",meta:'title=".changeset/brave-dryers-agree.md"',children:"---\n'module-example': patch\n---\n\npublish test\n"})}),"\n",(0,i.jsxs)(n.h2,{id:"版本更新",children:["版本更新",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#版本更新",children:"#"})]}),"\n",(0,i.jsx)(n.p,{children:"当需要更新项目版本的时候，执行以下命令："}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/guide/basic/command-preview#modern-bump",children:(0,i.jsx)(n.code,{children:"modern bump"})})}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["执行 ",(0,i.jsx)(n.code,{children:"modern bump"})," 将会基于 ",(0,i.jsx)(n.code,{children:".changeset/"})," 目录下记录了变更的 Markdown 文件内容来修改 ",(0,i.jsx)(n.code,{children:"package.json"})," 中的版本号，同时生成 ",(0,i.jsx)(n.code,{children:"CHANGELOG.md"})," 文件。",(0,i.jsx)(n.strong,{children:"而当版本更新完成后，这些记录变更的 Markdown 文件也会被删除，也可说这些 Markdown 文件被“消耗”掉了"}),"。"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-markdown",meta:'title="CHANGELOG.md"',children:"# module\n\n## 0.1.1\n\n### Patch Changes\n\n- publish test\n"})}),"\n",(0,i.jsxs)(n.h2,{id:"发布",children:["发布",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#发布",children:"#"})]}),"\n",(0,i.jsx)(n.p,{children:"发布项目可以执行以下命令："}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/guide/basic/command-preview#modern-release",children:(0,i.jsx)(n.code,{children:"modern release"})})}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"modern release"})," 命令可以将项目发布到 npm Registry。"]}),"\n",(0,i.jsxs)(n.p,{children:["此时发布的是 ",(0,i.jsx)(n.code,{children:"latest"})," 版本，也可以说是正式版本。如果想要修改 ",(0,i.jsx)(n.code,{children:"dist-tag"}),"，可以通过 ",(0,i.jsx)(n.code,{children:"modern release --tag"})," 命令来指定。例如："]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"modern release --tag beta\n"})}),"\n",(0,i.jsxs)(n.p,{children:["但是如果希望将当前项目的版本号也修改为预发布的版本号，则需要使用 ",(0,i.jsx)(n.code,{children:"modern pre"})," 命令。"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["所谓 ",(0,i.jsx)(n.code,{children:"dist-tag"}),"，可以理解：为当前发布的版本打标签。一般来说，默认发布的版本对应的 ",(0,i.jsx)(n.code,{children:"dist-tag"})," 为 ",(0,i.jsx)(n.code,{children:"latest"}),"，因此可以把 ",(0,i.jsx)(n.code,{children:"latest"})," 认为是正式版本的 ",(0,i.jsx)(n.code,{children:"dist-tag"}),"。"]}),"\n"]}),"\n",(0,i.jsxs)(n.h2,{id:"预发布",children:["预发布",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#预发布",children:"#"})]}),"\n",(0,i.jsx)(n.p,{children:"当需要在正式发布之前进行预发布，则需要执行以下命令："}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/guide/basic/command-preview#modern-pre",children:(0,i.jsx)(n.code,{children:"modern pre"})})}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["首先 ",(0,i.jsx)(n.code,{children:"modern pre enter <tag>"})," 进入预发布模式，",(0,i.jsx)(n.code,{children:"<tag>"})," 可以与发布项目的时候使用 ",(0,i.jsx)(n.code,{children:"modern release --tag"})," 命令指定的 ",(0,i.jsx)(n.code,{children:"tag"})," 一致。"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ npx modern pre enter next\n\uD83E\uDD8B  success Entered pre mode with tag next\n\uD83E\uDD8B  info Run `changeset version` to version packages with prerelease versions\n✨  Done in 5.30s.\n"})}),"\n",(0,i.jsxs)(n.p,{children:["接着可以使用 ",(0,i.jsx)(n.code,{children:"modern bump"})," 命令更新具体的版本号，",(0,i.jsx)(n.strong,{children:"此时不会真正的“消耗”记录变更的 Markdown 文件"}),"："]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ npx modern bump\n\uD83E\uDD8B  warn ===============================IMPORTANT!===============================\n\uD83E\uDD8B  warn You are in prerelease mode\n\uD83E\uDD8B  warn If you meant to do a normal release you should revert these changes and run `changeset pre exit`\n\uD83E\uDD8B  warn You can then run `changeset version` again to do a normal release\n\uD83E\uDD8B  warn ----------------------------------------------------------------------\n\uD83E\uDD8B  All files have been updated. Review them and commit at your leisure\n"})}),"\n",(0,i.jsxs)(n.p,{children:["然后可以看到 ",(0,i.jsx)(n.code,{children:"package.json"})," 中更新的版本号会类似这样：",(0,i.jsx)(n.code,{children:"0.1.2-next.0"}),"。"]}),"\n",(0,i.jsxs)(n.p,{children:["最后，",(0,i.jsxs)(n.strong,{children:["如果不需要再进行预发布，则一定要执行 ",(0,i.jsx)(n.code,{children:"modern pre exit"})," 命令"]}),"，这样可以退出预发布状态，并且当再次执行 ",(0,i.jsx)(n.code,{children:"modern bump"})," 命令的时候，就可以发布正式的版本。"]})]})}(s=globalThis).__RSPRESS_PAGE_META||(s.__RSPRESS_PAGE_META={}),globalThis.__RSPRESS_PAGE_META["zh%2Fguide%2Fbasic%2Fpublish-your-project.md"]={toc:[{text:"跟踪变更",id:"跟踪变更",depth:2},{text:"版本更新",id:"版本更新",depth:2},{text:"发布",id:"发布",depth:2},{text:"预发布",id:"预发布",depth:2}],title:"版本管理与发布",frontmatter:{sidebar_position:7}};var h=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=Object.assign({},(0,a.useMDXComponents)(),e.components).wrapper;return n?(0,i.jsx)(n,(0,c._)((0,d._)({},e),{children:(0,i.jsx)(l,(0,d._)({},e))})):l(e)}}}]);